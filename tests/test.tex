\documentclass[a4paper, DIV=9, oneside, toc=index]{scrreprt}
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[ngerman]{babel}
\usepackage{lmodern}
\usepackage{bera}
\usepackage{marvosym}
\usepackage{pst-optexp}
\usepackage{showexpl}
\usepackage{ltxdockit}
\makeatletter\renewcommand*\SX@Info{}\makeatother
\definecolor{colKeys}{rgb}{0,0,0}
\definecolor{colIdentifier}{rgb}{0,0,0}
\colorlet{colComments}{green!60!black}
\definecolor{colString}{rgb}{0,0.5,0} 
\definecolor{DOrange}{rgb}{1,.4,.2}%
\newlength{\codeoverhang}
\setlength{\codeoverhang}{0.5\marginparwidth+0.5\marginparsep}
\lstset{%
  language=[LaTeX]TeX, identifierstyle=\color{colIdentifier}, %
  keywordstyle=\color{colKeys}, %
  keywordstyle = [21]\color{DOrange}, %
  keywordstyle = [22]\color{DOrange}, %
  stringstyle=\color{colString}, %
  commentstyle=\color{colComments}, %
  float=hbp,%
  basicstyle=\ttfamily\small, %
  columns=flexible, %
  tabsize=4, %
  extendedchars=true, %
  showspaces=false, %
  showstringspaces=false, %
  breaklines=true, %
  breakautoindent=true, %
  captionpos=b, %
  xleftmargin=1em, %
  prebreak = {\raisebox{-1ex}[\ht\strutbox]{\kern0.5ex \Large\Righttorque}},
  rulecolor=\color{black!20}, %
  texcsstyle = [20]\color{DOrange}, %
  moretexcs = [20]{lens, optbox, oenode, oenodeIn, oenodeExt, oenodeOut,
    oenodeRefA, oenodeRefB, oenodeTrefA, oenodeTrefB, oenodeLabel,
    oenodeRotref, oenodeBeam, oenodeBeamUp, oenodeBeamLow,
    oenodeCenter, optplate, optretplate, pinhole, crystal,optdetector,
    optdiode, doveprism, polarization, mirror, beamsplitter, optgrating,
    optprism, rightangleprism, pentaprism, optdipole, optripole,
    optfiber, optamp, optmzm, optfilter, polcontrol, optisolator,
    optswitch, fiberdelayline, optfiberpolarizer, fibercollimator,
    optcoupler, wdmcoupler, wdmsplitter, drawbeam, drawwidebeam,
    drawfiber, frontlayer, backlayer, newOptexpDipole,
    newOptexpTripole, newOptexpFiberDipole}, %
  morekeywords = [22] {optexp},
  explpreset={%
    escapeinside={*}{*},
    pos=l, width=-99pt, hsep=5mm, overhang=\codeoverhang,
    varwidth, vsep=\bigskipamount, rframe={}}}
\lstset{
  literate={ö}{{\"o}}1
           {ä}{{\"a}}1
           {ü}{{\"u}}1
}
\newcommand\Lkeyword[1]{\texttt{#1}}
\makeatletter
\providecommand\ON{%
  \gdef\lst@alloverstyle##1{\textcolor{black!50}{\strut##1}%
}}
\providecommand\OFF{\xdef\lst@alloverstyle##1{##1}}
\makeatother
\begin{document}
\begin{pspicture}[showgrid=true](3,3)
  \optbox[labelref=global, showoptdots](0,1)(3,1){label}
\end{pspicture}
\end{document}
\begin{pspicture}(3,3)
  \pnode(1, 0.5){A}\pnode(2.5,0.5){B}\pnode(2.5,2){C}
  \psset{fiber=none, optbox=1 0.6, label=0 . . relative}
  \optbox[endbox](B)(A){start}
  \optbox[endbox](B)(C){stop}
  \drawfiber[fiberstyle=diag, linearc=0.5]{1}{2}
\end{pspicture}
\end{document}
\begin{pspicture}(13,5.5)
\psset{usefiberstyle, optboxwidth=1, labelstyle=\footnotesize, fiber=none}
\pnode(1,5){LD}\pnode([Xnodesep=5.5]LD){CPLin1}
\pnode([offset=-2]CPLin1){CPLin2}\pnode([Xnodesep=2.5]CPLin1){CPLout1}
\pnode([Xnodesep=2.5]CPLin2){CPLout2}\pnode([Xnodesep=3]CPLout1){RX}
\optbox[endbox, labeloffset=0](CPLin1)(LD){LD}
\optmzm[abspos=0.8](LD)(CPLin1){MZM}
\optamp[abspos=2](LD)(CPLin1){EDFA}
\optfilter[abspos=3](LD)(CPLin1){BPF}
\optswitch[abspos=4](LD)(CPLin1){SW}
\polcontrol[abspos=5, fiber=out](LD)(CPLin1)
\drawfiber{1}{2}{3}{4}{5}{6}
\optcoupler[couplertype=none, fiber](CPLin1)(CPLin2)(CPLout1)(CPLout2)
\optamp[abspos=0.8, fiber=in](CPLout1)(RX){EDFA}
\optfilter[abspos=2](CPLout1)(RX){BPF}
\optbox[endbox](CPLout1)(RX){RX}
\drawfiber{8}{9}{10}
\pnode([Xnodesep=-0.5]LD|CPLin2){TL}\pnode(RX|TL){TR}
\pnode([offset=-2.5]TR){BR}\pnode(TL|BR){BL}
\optamp[fiber=i](CPLout2)(TR){EDFA}
\optfiber[label=0.3 . t, position=0.85](BL)(BR){SSMF 89.8~km}
\drawfiber[fiberstyle=angle, arm=1.2, linearc=0.5, startnode=N]{11}{12}
\optamp[position=0.3](BR)(BL){EDFA}
\optfilter[position=0.55, labelangle=180](BL)(BR){BPF}
\optfiber[fiberloops=1, label=0.3 . t, position=0.35](BL)(BR){DCF 16.2~km}
\optamp[position=0.85](BR)(BL){EDFA}
\optfilter[position=0.2](TL)(CPLin2){BPF}
\optswitch(TL)(CPLin2){SW}
\polcontrol[position=0.8, fiber=out](TL)(CPLin2)
\drawfiber{12}{13}{14}{15}{16}\drawfiber{17}{18}{19}
\drawfiber[fiberstyle=angle, arm=0.5, linearc=0.5, stopnode=1]{16}{17}
\end{pspicture}

\begin{pspicture}[showgrid](3,3)
  \addtopsstyle{Fiber}{arrows=->, linecolor=DOrange}
  \newpsstyle{OptCircArrow}{unit=0.7, arrowinset=0}
  \optcirculator[angle=20, fiberstyle=angle, linearc=0.1](0,1)(1,0)(3,1)
  \psdot(\oenodeRefA{})
  \psdot(\oenodeRefB{})
\end{pspicture}
\end{document}

\begin{pspicture}(5,4)
  \pnode(0.5,3){A}
  \pnode(3, 3){B}
  \pnode(3,0){C}
  \pentaprism(A)(B)(C)
  \addtopsstyle{Beam}{raytrace=false, fillstyle=solid, fillcolor=red}
  \drawwidebeam[beamwidth=0.1]{(A)}{1}{(C)}
\end{pspicture}
\begin{pspicture}(5,4)
  \pnode(0.5,3){A}
  \pnode(3, 3){B}
  \pnode(3,0){C}
  \pentaprism(A)(B)(C){}
  \addtopsstyle{Beam}{raytrace=false, fillstyle=solid, fillcolor=red}
  \drawwidebeam[beamdiv=6, beamwidth=0.1]{(A)}{1}{(C)}
\end{pspicture}

\begin{pspicture}(10,2)
  \pnode(0,1){A}
  \pnode(10,1){B}
  \doveprism[doveprismsize=2](A)(B)
  \addtopsstyle{Beam}{raytrace=false, fillstyle=solid, fillcolor=red}
  \drawwidebeam[beamdiv=6, beamwidth=0.1]{(A)}{1}{(B)}
\end{pspicture}

\begin{pspicture}[showgrid](5,5)
  \optbox[angle=20](0,1)(2,1)
  \optbox[angle=-20](2,1)(4,1)
  \drawfiber[fiberangle=ref, fiberangleA=20, fiberangleB=-20]{1}{2}
\end{pspicture}

\begin{pspicture}[showgrid](3,3)
  \fiberbox[showifcnodes, fiberboxoutcount=3, fiberboxincount=2](0,1)(3,1)
  \drawfiber[startnode=3]{}{(3,1.5)}
  \drawfiber{}{(3,1.5)}
\end{pspicture}

\begin{pspicture}[showgrid](3,3)
  \optbox[extnode={0.5,0.5}](0,1)(3,1)\psdot(\oenodeExt{})
\end{pspicture}
\begin{pspicture}(0,0.5)(3,1.6)
\addtopsstyle{CrystalCaxis}{linecolor=gray}
\crystal[voltage, caxisinv, beam](0,1)(3,1)
\end{pspicture}

\begin{pspicture}[showgrid](3,4)
  \optcoupler(0,3)(0,2)(3,3)(3,2)
  \optbox(0,1)(3,1)
\end{pspicture}
\begin{pspicture}[showgrid](3,4)
  \psset{fiber=tr}
  \optcoupler(0,3)(0,2)(3,3)(3,2)
  \optbox(0,1)(3,1)
\end{pspicture}
\begin{pspicture}[showgrid](3,4)
  \psset{fiber=l}
  \optcoupler(0,3)(0,2)(3,3)(3,2)
  \optbox(0,1)(3,1)
\end{pspicture}
\begin{pspicture}[showgrid](3,4)
  \psset{fiber=b}
  \optcoupler(0,3)(0,2)(3,3)(3,2)
  \optbox(0,1)(3,1)
\end{pspicture}
\begin{pspicture}[showgrid](3,4)
  \psset{fiber=none}
  \optcoupler(0,3)(0,2)(3,3)(3,2)
  \optbox(0,1)(3,1)
\end{pspicture}

\begin{pspicture}[showgrid](3,4)
  \optcoupler(0,3)(0,2)(3,3)(3,2)
  \optbox(0,1)(3,1)
\end{pspicture}
\begin{pspicture}[showgrid](3,4)
  \psset{fiber*=tr}
  \optcoupler(0,3)(0,2)(3,3)(3,2)
  \optbox(0,1)(3,1)
\end{pspicture}
\begin{pspicture}[showgrid](3,4)
  \psset{fiber*=l}
  \optcoupler(0,3)(0,2)(3,3)(3,2)
  \optbox(0,1)(3,1)
\end{pspicture}
\begin{pspicture}[showgrid](3,4)
  \psset{fiber=b}
  \optcoupler(0,3)(0,2)(3,3)(3,2)
  \optbox(0,1)(3,1)
\end{pspicture}
\begin{pspicture}[showgrid](3,4)
  \psset{fiber*=none}
  \optcoupler(0,3)(0,2)(3,3)(3,2)
  \optbox(0,1)(3,1)
\end{pspicture}

\begin{pspicture}[showgrid](3,3)
\optbox(0,0.5)(3,0.5)
\psdot(\oenodeCenter{})
\psline[linecolor=red](\oenodeRefA{})(\oenodeRefB{})
\optdetector(0,1.5)(2.5,1.5)
\psdot(\oenodeCenter{})
\psline[linecolor=red](\oenodeRefA{})(\oenodeRefB{})
\end{pspicture}


\begin{pspicture}(11,2)
\psset{couplersize=0.5, couplertype=rectangular, couplersep=0.2}
\optcoupler(0, 2)(0,0.7)(3,2)(3,0.7)
\psdot(\oenodeRefA{})\uput[90](\oenodeRefA{}){RefA}
\psdot(\oenodeRefB{})\uput[90](\oenodeRefB{}){RefB}
\optcoupler[align=top](4, 2)(4,0.7)(7,2)(7,0.7)
\psdot(\oenodeRefA{})\uput[-90](\oenodeRefA{}){RefA}
\psdot(\oenodeRefB{})\uput[-90](\oenodeRefB{}){RefB}
\optcoupler[align=bottom](8, 2)(8,0.7)(11,2)(11,0.7)
\psdot(\oenodeRefA{})\uput[90](\oenodeRefA{}){RefA}
\psdot(\oenodeRefB{})\uput[90](\oenodeRefB{}){RefB}
\rput[b](1.5,0){\opt{align=none}}
\rput[b](5.5,0){\opt{align=top}}
\rput[b](9.5,0){\opt{align=bottom}}
\end{pspicture}

\begin{pspicture}[showgrid](5,5)
  \fibercollimator(0,1)(5,1)
  \fibercollimator[fiber=none](0,3)(5,3)
\end{pspicture}
\begin{pspicture}[showgrid](3,1.5)
  \newpsstyle{OptComp}{linewidth=2\pslinewidth}
  \optfilter(0,1)(1.5,1)
  \newpsstyle{FilterInt}{linewidth=0.5\pslinewidth}
  \optfilter(1.5,1)(3,1)
\end{pspicture}

\begin{pspicture}[showgrid](5,5)
  \polcontrol(0,1)(5,1){PC}
  \polcontrol[polcontroltype=triangle](0,3)(5,3){PC}
\end{pspicture}

\begin{pspicture}[showgrid](5,5)
  \crystal[lamp, position=-0.1](0,1)(5,1)
  \crystal[lamp, lampscale=0.2](0,3)(5,3)
\end{pspicture}
\begin{LTXexample}[pos=t, caption={caption}]
\begin{pspicture}(1,1.2)(6.2,5)
\pnode(1,4){SigIn}\pnode(3,4){BS}\pnode(3,5){LO}
\pnode(5,4){Det1}\pnode(3,2){Det2}
\begin{optexp}
  \optplane[compname=LO](LO)(1,0)
  \beamsplitter[compname=BS](SigIn)(BS)(Det2)
  \lens[abspos=0.5, compname=L2, n=2.1](Det2)(BS){$L_2$}
  \lens[abspos=0.5, compname=L1, n=2.1](Det1)(BS){$L_1$}
  \optdetector[compname=Det1, extnode=c](BS)(Det1){PD1}
  \optdetector[compname=Det2, extnode=c](BS)(Det2){PD2}
  \addtopsstyle{Beam}{beamwidth=0.2, fillstyle=solid, 
                        fillcolor=green, opacity=0.2}
  \drawwidebeam{(SigIn)}{BS}{L2}{Det2}
  \drawwidebeam[beaminsidefirst]{BS}{L1}{Det1}
  \newpsstyle{Beam}{linecolor=red, linestyle=dashed, linewidth=1.5\pslinewidth}
  \drawbeam{LO}{BS}{L1}{Det1}
  \drawbeam[beaminsidefirst]{BS}{L2}{Det2}
\end{optexp}
\cnodeput([Xnodesep=0.5, offset=-0.5]\oenodeExt{Det1}|\oenodeExt{Det2})%
           {M}{\rule{3mm}{1pt}}
\psset{arrows=<-, arrowscale=1.5, arrowinset=0}
\nccurve[angleA=90]{M}{\oenodeExt{Det1}}
\nccurve[angleA=180, angleB=-90]{M}{\oenodeExt{Det2}}
\end{pspicture}
\end{LTXexample}


\makeatletter
\newOptexpTripole{reflslm}{}
\def\reflslm@comp{%
  \psframe[fillstyle=solid,fillcolor=gray!50](-0.3,0)(0.3,0.2)
  \psline(-0.3,0.1)(-0.5,0.1)(-0.5,0.5)(0.5,0.5)(0.5,0.1)(0.3,0.1)
}%
\makeatother
\begin{pspicture}(0.3,0.1)(5.5,8)
\pnode(2,7){L}\pnode(2,5.5){Pbs}\pnode([Xnodesep=1]Pbs){Blk1}
\pnode(2,2){Bs}\pnode([Xnodesep=-1]Bs){Blk2}
\pnode([Xnodesep=3.5]Bs){Out}\pnode(2,1){Slm}
\begin{optexp}
\optbox[endbox, innerlabel, optboxheight=1](Pbs)(L){\begin{tabular}{@{}c@{}}Laser\\532\,nm\end{tabular}}
\psset{labelalign=r}
\optretplate(L)(Pbs){HWP}
\beamsplitter[labelangle=-90](L)(Pbs)(Blk1){PBS}
\psset{mirrortype=extended}
\newpsstyle{ExtendedMirror}{fillstyle=solid, fillcolor=black}
\mirror[label=. -90 c](Pbs)(Blk1)(Pbs){B}
\lens[abspos=0.8, lens=0.7 0.7 0.7, n=2](Pbs)(Bs){MO}
\pinhole[phwidth=0.15, abspos=1.2](Pbs)(Bs){PH}
\lens[abspos=2.6, lensradius=1.4](Pbs)(Bs){L}
\psset{labelalign=c}
\beamsplitter[labelangle=-135](Pbs)(Bs)(Blk2){BS}
\mirror[labeloffset=0.4](Bs)(Blk2)(Bs){B}
\lens[abspos=1, lensradius=1.4](Bs)(Out){L}
\lens[abspos=2.8, lens=0.7 0.7 0.7, n=2](Bs)(Out){L}
\reflslm(Bs)(Slm)(Bs){SLM}
\addtopsstyle{Beam}{linestyle=none, fillstyle=solid, fillcolor=green!70!black}
\drawwidebeam[beamwidth=0.1]{1-4}
\drawwidebeam[beamwidth=0.1, beaminsidefirst, beaminsidelast]{3}{5-8}
\psset{savebeampoints=false, loadbeampoints}
\drawwidebeam{8-11}{(Out)}
\drawwidebeam[beaminsidefirst]{8}{12}
\end{optexp}
\end{pspicture}

Im Folgenden wird ein sehr einfacher Aufbau mit einer konkaven und einer konvexen Linse schrittweise erläutert.

Zuerst werden die Referenzknoten definiert, die für die Ausrichtung der
Komponenten verwendet werden. Zur besseren Übersicht werden beide Knoten
gekennzeichnet, ein Koordinatengitter dient desweiteren der Orientierung.

Die erste Linse soll konkav gekrümmte Grenzflächen haben. Mit \Lkeyword{lensradius} werden die Krümmungen der rechten und linken Fläche auf denselben Wert gesetzt, ein negativer Wert ergibt eine konkave Krümmung. Bei K

\begingroup
\catcode`\*=13
\def*{}%
\begin{LTXexample}
*\ON*\begin{pspicture}[showgrid](5,2)
  \pnode(0,1){In}\pnode(3.5,1){Out}
  \psdot(In)\psdot(Out)*\OFF*
  \lens[lensradius=-0.7,
          abspos=1](In)(Out){concave}
*\ON*\end{pspicture}*\OFF*
\end{LTXexample}
\endgroup

\begingroup
\catcode`\*=13
\def*{}%
\begin{LTXexample}
*\ON*\begin{pspicture}[showgrid](5,2)
  \pnode(0,1){In}\pnode(3.5,1){Out}
  \psdot(In)\psdot(Out)
  \lens[lensradius=-0.7, 
          abspos=1](In)(Out){concave}*\OFF*
  \lens[lensradius=2.3, lensheight=1.3, 
          abspos=2.6](In)(Out){convex}
*\ON*\end{pspicture}*\OFF*
\end{LTXexample}
\endgroup

\begingroup
\catcode`\*=13
\def*{}%
\begin{LTXexample}
*\ON*\begin{pspicture}[showgrid](5,2)
  \pnode(0,1){In}\pnode(3.5,1){Out}
  \psdot(In)\psdot(Out)
  \lens[lensradius=-0.7,
          abspos=1](In)(Out){concave}
  \lens[lensradius=2.3, lensheight=1.3, 
          abspos=2.6](In)(Out){convex}*\OFF*
  \optbox[endbox, labeloffset=0](In)(Out){CCD}
*\ON*\end{pspicture}*\OFF*
\end{LTXexample}
\endgroup

\begingroup
\catcode`\*=13
\def*{}%
\begin{LTXexample}
*\ON*\begin{pspicture}(5,2)
  \pnode(0,1){In}\pnode(3.5,1){Out}
  \lens[lensradius=-0.7, 
          abspos=1](In)(Out){concave}
  \lens[lensradius=2.3, lensheight=1.3, 
          abspos=2.6](In)(Out){convex}
  \optbox[endbox, labeloffset=0](In)(Out){CCD}*\OFF*
  \drawwidebeam[beamwidth=0.2]{(In)}{1}{2}{3}
*\ON*\end{pspicture}*\OFF*
\end{LTXexample}
\endgroup

\begingroup
\catcode`\*=13
\def*{}%
\begin{LTXexample}
*\ON*\begin{pspicture}(5,2)
  \pnode(0,1){In}\pnode(3.5,1){Out}
  \lens[lensradius=-0.7, 
          abspos=1](In)(Out){concave}
  \lens[lensradius=2.3, lensheight=1.3, 
          abspos=2.6](In)(Out){convex}
  \optbox[endbox, labeloffset=0](In)(Out){CCD}*\OFF*
  \addtopsstyle{Beam}{fillstyle=solid, 
    fillcolor=green, opacity=0.2}
  *\ON*\drawwidebeam[beamwidth=0.2]{(In)}{1}{2}{3}
\end{pspicture}*\OFF*
\end{LTXexample}
\endgroup


\begin{lstlisting}
§\ON§\begin{pspicture}[showgrid](5,5)§\OFF§
  \lens(0,1)(5,1)
  §\ON§\drawwidebeam[startinside, beamwidth=0.2, beamdiv=-20]{}{(5,1)}
\end{pspicture}§\OFF§
\end{lstlisting}

\begin{pspicture}[showgrid=true](5,2)
\pnode(1.4,1){A}\pnode(4.5,1){B}
\psset{fiber=none}
\optbox[endbox, labeloffset=0](B)(A){laser}
\polcontrol[abspos=0.6](A)(B){PC}
\optmzm[abspos=1.9](A)(B){MZM}
\optdetector(A)(B){PD}
\drawfiber{1}{2}{3}{4}
\end{pspicture}
\bigskip

\begin{pspicture}[showgrid=true](5,2)
\pnode(1.4,1){A}\pnode(2.6,1){B}\pnode(4,1){C}\pnode(4.5,1){D}
\optbox[endbox, labeloffset=0](B)(A){laser}
\polcontrol(A)(B){PC}
\optmzm(B)(C){MZM}
\optdetector[fiber](C)(D){PD}
\end{pspicture}
\bigskip

\begin{pspicture}[showgrid](5,5)
  \pnode(0,3){A}\pnode(3,3){B}\pnode(3,0){C}
  \mirror[mirrortype=extended, compshift=-0.5](A)(B)(C)
\end{pspicture}

\begin{pspicture}[showgrid](-0.2,0.1)(8.2,5.3)
  \pnode(0,3){M1}
  \pnode(8,3){M2}
  \pnode(8,0.5){In}
  \pnode(6.5,0.5){Min}
  \pnode(6.5,3){Pin}
  \pnode(4.5,3){Min2}
  \pnode(1.3, 0.5){Mout}
  \pnode(1.3,3){Pout}
  \pnode(3.5,3){Mout2}
  \pnode(0,0.5){Out}
  \definecolor[ps]{bl}{rgb}{tx@addDict begin Red Green Blue end}
  \addtopsstyle{Beam}{linecolor=bl, linejoin=1}
  \psset{mirrortype=extended, mirrordepth=0.15}
  \newpsstyle{ExtendedMirror}{linestyle=none, hatchwidth=0.5\pslinewidth, hatchsep=1.2\pslinewidth,
                fillstyle=hlines}
  \begin{optexp}
  \mirror[mirrorwidth=4, mirrorradius=11.](M2)(M1)(M2)
  \mirror[mirrorwidth=4, mirrorradius=10.4](M1)(M2)(M1)
  \mirror(In)(Min)(Pin)
  \optprism[n=1.85, addtoOptComp={linewidth=1.5\pslinewidth}](Min)(Pin)(Min2)
  \mirror[compshift=-0.4](Pin)(Min2)(Pin)
  \mirror[compshift=0.4](Pout)(Mout2)(Pout)
  \optprism[n=1.85, linewidth=1.5\pslinewidth](Mout2)(Pout)(Mout)
  \mirror(Pout)(Mout)(Out)
  \multido{\i=0+1}{40}{%
    \pstVerb{%
      \i\space 650 400 sub 39 div mul 400 add 
      tx@addDict begin wavelengthToRGB end }%
    \drawbeam[nadd=-0.002 \i\space mul, beaminsidelast]{(In)}{3-5}{2}{1}{6-7}
  }%
  \newpsstyle{Beam}{linecolor=red}
  \backlayer{\psline[style=Beam,ArrowInside=->, linewidth=2\pslinewidth, arrowinset=0](In)(\oenodeIn{3})(\oenodeOut{4})}
  \drawbeam[linewidth=2\pslinewidth, arrows=->, arrowinset=0, beamangle=-90, beamangleabs]{(\oenodeBeam)}{8}{(Out)}  
\end{optexp}
\rput(4,4.5){%
  \psframe[fillstyle=solid,fillcolor=gray!70](-0.1, -0.6)(0.1, 0.7)
  \multido{\r=-0.5+0.1}{12}{%
    \psline[linewidth=0.5\pslinewidth](-0.1,\r)(0.1,\r)
  }%
}
\end{pspicture}

\begin{pspicture}(4,3)
  \pnode(0,0.5){A}\pnode(2,0.5){B}
  \pnode([offset=1]B){C}\pnode(A|C){D}
  \psset{label=0}
  \optbox(A)(B){Box1}\optbox(C)(D){Box2}
  \drawfiber{1}{2}
\end{pspicture}

Czerny-Turner monochromator

\begin{pspicture}[showgrid=true](0,-1)(8,4)
\psset{linewidth=1.5\pslinewidth, mirrordepth=0.15}
\psframe[fillstyle=solid,fillcolor=gray!90,linestyle=none](0,-1)(8.5,4)
\addtopsstyle{OptComp}{linecolor=white, linewidth=1.5\pslinewidth}\addtopsstyle{Beam}{linewidth=1.5\pslinewidth, linecolor=white}
\addtopsstyle{ExtendedMirror}{hatchcolor=white, hatchsep=0.5\pslinewidth}
\pnode(0,3){A}\pnode(8,3){B}\pnode(3,1.5){C}\pnode(8,0){D}\pnode(0,0){E}%
\psset{mirrorradius=13,  mirrorwidth=1.5, gratingwidth=1.5, mirrortype=extended, phwidth=0.07, outerheight=1.5}%
\begin{optexp}
\pinhole[position=0.2](A)(B)%
\mirror(A)(B)(C)
\optgrating[reverse, angle=15](B)(C)(D)
\mirror(C)(D)(E)
\pinhole[position=0.8](D)(E)
\drawwidebeam[addtoBeam={ArrowInside=->}, beamwidth=0.2, beamdiv=0.1 8 0.2 mul atan neg 2 mul]{(A)}{1-3}
\psset{loadbeampoints, savebeampoints=false}%
\drawwidebeam[addtoBeam={linecolor=green!60!white}]{3-5}{(E)}
\drawwidebeam[beamangle=3, addtoBeam={linecolor=blue!60!white}]{3-6}
\drawwidebeam[beamangle=-3, addtoBeam={linecolor=red!60!white}]{3-6}
\end{optexp}
\end{pspicture}

\begin{pspicture}[showgrid=true](0,0)(12,2) 
  \pnode(0,1){A}\pnode(3.5,1){B}
  \lens[abspos=1](A)(B)
  \addtopsstyle{Beam}{fillstyle=solid, fillcolor=green, opacity=0.3}
  \drawwidebeam[beamwidth=0.5]{(A)}{}
  \psdot(\oenodeBeamUp)\psdot(\oenodeBeamLow)
  \uput[90](\oenodeBeamUp){\rput[rb](0,0){BeamUp}}
  \uput[-90](\oenodeBeamLow){\rput[rt](0,0){BeamLow}}
  \drawwidebeam[beamwidth=0.5, skipconn=1]{(A)}{}{(B)}
  \psdot(\oenodeBeamUp)\psdot(\oenodeBeamLow)
  \uput[90](\oenodeBeamUp){\rput[rb](0,0){BeamUp}}
  \uput[-90](\oenodeBeamLow){\rput[rt](0,0){BeamLow}}
\end{pspicture}

\begin{pspicture}(4,3)
  \pnode(0,0.5){A}\pnode(2,0.5){B}\pnode(4,3){C}
  \nodexn{(C)-(1.5,0)}{C'}
  \optgrating(A)(B)(C)
  \addtopsstyle{Beam}{fillstyle=solid, fillcolor=green, opacity=0.3}
  \drawwidebeam[beamwidth=0.3]{(A)}{1}
  \psset{loadbeampoints}
  \drawwidebeam{1}{(C)}
  \drawwidebeam{1}{(C')}
  \rput[rb]([Xnodesep=0.3, offset=0.2]C){0. order}
  \rput[rb]([offset=0.2]C'){1. order}
\end{pspicture}

\begin{pspicture}(4,2) 
  \pnode(0,1){A}\pnode(4,1){B}
  \begin{optexp}
  \lens[lens=0.5 0.5 0.5, abspos=0.5](A)(B)
  \lens[lens=4 4 2, abspos=2](A)(B)
  \addtopsstyle{Beam}{fillstyle=solid, fillcolor=green, opacity=0.3}
  \psset{savebeampoints, loadbeampoints}
  \drawwidebeam[beamwidth=0.2, stopinside]{(A)}{1}
  \drawwidebeam[beamdiv=-60]{1}{2}
  \drawwidebeam{2}{(B)}
  \end{optexp}
\end{pspicture}

\begin{pspicture}(3,3)
  \psset{endbox, optboxwidth=0.5, optboxheight=0.5, bssize=0.5}
  \optbox[compname=obj](0.5,0.5)(0.5,2.5){obj, 1}
  \beamsplitter(0.5,2.5)(0.5,1)(2.5,1){2}
  \optbox(0.5,1)(2.5,1){3}
  % named objects are also numbered
  \drawbeam{1-3}
\end{pspicture}

\begin{pspicture}(2.8,3) 
  \pentaprism[pentaprismsize=1.3](0,1.5)(1.5,1.5)(1.5,0)
  \drawbeam[arrows=->, arrowinset=0, arrowscale=1.5]{(0,1.5)}{}{(1.5,0)}
%  \psdot(\oenodeIn{})\uput[135](\oenodeIn{}){1}
%  \psdot(\oenodeIfc{2}{})\uput[0](\oenodeIfc{2}{}){2}
%  \psdot(\oenodeIfc{3}{})\uput[90](\oenodeIfc{3}{}){3}
%  \psdot(\oenodeOut{})\uput[-45](\oenodeOut{}){N}
\end{pspicture}

\begin{pspicture}[showgrid=true](4,6) \psset{labeloffset=0.6}
  \addtopsstyle{Beam}{arrows=->, arrowscale=1.5}
  \doveprism[compname=Dove1](0,0.8)(3,0.8){Dove1}
  \drawbeam[conn=b-]{Dove1}{(3,0.8)}
  \doveprism[compname=Dove2](0,2.3)(3,2.3){Dove2}
  \drawbeam[conn=B-]{Dove2}{(3,2.3)}
  \doveprism[compname=Dove3](0,3.8)(3,3.8){Dove3}
  \drawbeam[conn=-a]{(0,3.8)}{Dove3}
  \doveprism[compname=Dove4](0,5.3)(3,5.3){Dove4}
  \drawbeam[conn=-A]{(0,5.3)}{Dove4}
\end{pspicture}


  \begin{pspicture}[showgrid=true](3,2)
  \pnode(0,1){A}
  \pnode(3,1){B}
  \optbox[labeloffset=0.7, optboxwidth=0.5, optboxheight=1, angle=20, refractiveindex=2.3, compname=Box](A)(B){glass plate}
  \drawbeam[conn=-a]{(A|BoxIntern1)}{Box}
  \drawbeam[conn=B-]{Box}{(B|BoxInternN)}
\end{pspicture}

\begin{pspicture}[showgrid=true](3,1.5)
  \psset{optgridlinewidth=1}
  \psset{labelangle=45, labeloffset=2}
  \optbox[abspos=3.7, label=. 90, compname=box](0,1)(3,1){box}
  \drawbeam[conn=a-a]{(0,1)}{box}
\end{pspicture}

\begin{pspicture}(3,1.5)
\addtopsstyle{OptComp}{linewidth=3\pslinewidth, linecolor=red}
\newpsstyle{OptionalStyle}{linecolor=blue}
\lens(0,1)(2,1)
% linecolor overwritten, linewidth of OptComp
\lens[optional](0,1)(3,1)
\end{pspicture}

\begin{pspicture}(3,2)
\mirror[showoptdots, angle=0, beam, skipconn=-1](0,1)(1.9,1)(1.9,0)
\end{pspicture}


\begin{pspicture}(5,5)
  \lens(0,3)(3,3)
  \optgrating(0,3)(3,3)(3,0)
  \lens(3,3)(3,0)
  \addtopsstyle{Beam}{beamwidth=0.2, fillstyle=solid, fillcolor=red}
  \drawwidebeam[skipconn=3]{(0,3)}{-}{(3,0)}
\end{pspicture}

\begin{pspicture}(4,3)
  \pnode(0,0.5){A}\pnode(2,0.5){B}\pnode(4,3){C}
  \nodexn{(C)-(1.5,0)}{C'}
  \optgrating(A)(B)(C)
  \addtopsstyle{Beam}{fillstyle=solid, fillcolor=green, opacity=0.3}
  \drawwidebeam[beamwidth=0.3]{(A)}{1}{(C)}
  \psset{savebeampoints, loadbeampoints}
  \drawwidebeam[beamwidth=0.3]{(A)}{1}
  \drawwidebeam{1}{(C')}
  \rput[rb]([Xnodesep=0.3, offset=0.2]C){0. order}
  \rput[rb]([offset=0.2]C'){1. order}
\end{pspicture}

\begin{pspicture}(4,2) 
  \pnode(0,1){A}\pnode(4,1){B}
  \begin{optexp}
  \lens[lens=0.5 0.5 0.5, abspos=0.5](A)(B)
  \lens[lens=4 4 2, abspos=2](A)(B)
  \addtopsstyle{Beam}{fillstyle=solid, fillcolor=green, opacity=0.3}
  \psset{savebeampoints, loadbeampoints}
  \drawwidebeam[beamwidth=0.2, stopinside]{(A)}{1}
  \drawwidebeam[beamdiv=-60]{1}{2}
  \drawwidebeam{2}{(B)}
  \end{optexp}
\end{pspicture}

\begin{pspicture}[showgrid=true](5,5)
  \mirror[mirrorradius=2](0,3)(2,1)(0,0)
  \drawwidebeam[raytrace=false, beamwidth=0.2]{(0,3)}{}{(0,0)}
  \lens(0,4)(5,4)
  \drawwidebeam[raytrace=false, beamwidth=0.2]{(0,4)}{}{(5,4)}
\end{pspicture}

\begin{pspicture}(2.1,3)
\pnode(0,0){A}\pnode(2,0){B}
\pnode(0.3,3){C}\pnode(1.7,3){D}
\optcoupler[fiber=i,
            addtoFiberIn1={angleA=0, ArrowInside=->},
            addtoFiberIn2={angleA=180, arrows=<-},
            abspos=0.5, compname=Cpl](A)(B)(C)(D){}
\optfiber[fiber=none, compname=Hnlf, abspos=1](C)(C|A){}
\optamp[fiber=none, abspos=2, compname=Amp](D|B)(D){}
\drawfiber{Cpl}{Hnlf}
\drawfiber[startnode=1, stopnode=N, ncurv=1.2]{Hnlf}{Amp}
\drawfiber{Cpl}{Amp}
\end{pspicture}

\begin{pspicture}(3,4)
  \psset{beam, fillstyle=solid, fillcolor=black}
  \optbox(0,3.5)(3,3.5){no layers}
  \begin{optexp}
    \optbox(0,1.5)(3,1.5){with layers}
  \end{optexp}
\end{pspicture}

\begin{pspicture}(3,2.5)
  \pnode(0,2){A}\optplane[compname=A](A)(0,1)
  \pnode(4,0){B}\optplane[compname=B](3,0)(0,1)
  \optprism[n=1.8](A)([Xnodesep=2]A)(B)
  \addtopsstyle{Beam}{fillcolor=red, fillstyle=solid, opacity=0.3}
  \drawwidebeam[beamdiv=10]{A}{3}{B}
\end{pspicture}

\begin{pspicture}(3,2.7)
  \lens[lens=2 2 2, abspos=2.5](0,1)(3,1)
  \optplane[compname=A](0,1)(0,1)
  \optplane[compname=B](3,1)(0,1)
  \drawbeam{A}{1}{B}
  \drawbeam[beamangle=15]{A}{1}{B}
  \drawbeam[beamangle=28]{A}{1}{B}
  \drawbeam[beamangle=29]{A}{1}{B}
  \drawbeam{A}{1}{B}
\end{pspicture}

\begin{pspicture}[showgrid=true](5,5)
  \pnode(0,1){A}
  \pnode(5,1){B}
  \lens[compshift=0.2, angle=20](A)(B)
  \psset{beamangleabs}
  \drawbeam{(A)}{1}
  \drawbeam[n=1, beampos=0.2, savebeampoints, stopinside]{(A)}{1}
  \drawbeam[loadbeampoints, beamangle=10]{1}{(B)}
  \addtopsstyle{Beam}{linestyle=none, fillcolor=red, fillstyle=solid}
  \drawwidebeam[n=1, beamwidth=0.3, savebeampoints, stopinside]{(A)}{1}
  \drawwidebeam[loadbeampoints, beamangle=10]{1}{(B)}
\end{pspicture}

\begin{pspicture}(4,2) 
  \pnode(0,1){A}\pnode(4,1){B}
  \begin{optexp}
  \lens[lens=0.5 0.5 0.5, abspos=0.5](A)(B)
  \lens[lens=4 4 2, abspos=2](A)(B)
  \addtopsstyle{Beam}{fillstyle=solid, fillcolor=green, opacity=0.3}
  \psset{loadbeampoints, savebeampoints}
  \drawwidebeam[beamwidth=0.2, stopinside]{(A)}{1}
  \drawwidebeam[beamdiv=-60]{1}{2}
  \drawwidebeam{2}{(B)}
  \end{optexp}
\end{pspicture}

\lstset{explpreset={%
    escapeinside={*}{*}, pos=l,width=-99pt,overhang=0pt,hsep=5mm,
    varwidth,vsep=\bigskipamount,rframe={}}, }

\begin{LTXexample}[explpreset={escapeinside={}}]
\begin{pspicture*}(0,2)(3.05,6)
  \lens[lens=8 8 8, abspos=0.6](0.5,2)(3,2)
  \optplate[position=1, plateheight=6](0.5,2)(3,2)
  \psset{beampos=2.1}
  \drawbeam[beamangle=-60]{1}{2}
  \drawbeam[beamangle=-40]{1}{2}
  \drawbeam[beamangle=-20]{1}{2}
  \psline[linecolor=gray!50, linewidth=3\pslinewidth, arrows=->, arrowinset=0, arrowscale=1.3](\oenodeOut{1})([offset=2.1]\oenodeOut{1})
\end{pspicture*}
\end{LTXexample}

\begin{pspicture}[showgrid=true](0,-0.5)(12,2.5)
\psset{couplersize=0.5, couplertype=rectangular, couplersep=0.2}
\wdmsplitter(0, 1)(3,2)(3,0)
\psdot(\oenodeIfc{1}{})\uput[180](\oenodeIfc{1}{}){1}
\psdot(\oenodeIfc{2}{})\uput[0](\oenodeIfc{2}{}){2}
\psdot(\oenodeIfc{N}{})\uput[0](\oenodeIfc{N}{}){N}
\wdmcoupler(4, 2)(4,0)(7,1)
\psdot(\oenodeIfc{1}{})\uput[180](\oenodeIfc{1}{}){1}
\psdot(\oenodeIfc{2}{})\uput[180](\oenodeIfc{2}{}){2}
\psdot(\oenodeIfc{N}{})\uput[0](\oenodeIfc{N}{}){N}
\optcoupler(8,2)(8,0)(11,2)(11,0)
\psdot(\oenodeIfc{1}{})\uput[180](\oenodeIfc{1}{}){1}
\psdot(\oenodeIfc{2}{})\uput[180](\oenodeIfc{2}{}){2}
\psdot(\oenodeIfc{3}{})\uput[0](\oenodeIfc{3}{}){3}
\psdot(\oenodeIfc{N}{})\uput[0](\oenodeIfc{N}{}){N}
\end{pspicture}

\newpsobject{MOLensIn}{lens}{lens=0.5 0.5 0.5}
\newpsobject{MOLensOut}{lens}{lens=4 4 2}
\begin{pspicture}[showgrid=true](5,2) 
   \pnode(0,1){A}\pnode(5,1){B}
   \psset{n=1}
   \begin{optexp}
   \MOLensIn[abspos=0.5](A)(B){}
   \MOLensOut[abspos=1](A)(B){}
   \MOLensOut[abspos=4](A)(B){}
   \MOLensIn[abspos=4.5](A)(B){}
   \addtopsstyle{Beam}{fillstyle=solid, fillcolor=red, opacity=0.3}
   \psset{loadbeampoints, savebeampoints}
   \drawwidebeam[beamwidth=0.2]{(A)}{1}
   \drawwidebeam[beamdiv=90]{1}{2}
   \drawwidebeam[stopinside]{2}{3}
   \drawwidebeam[beamdiv=-90]{3}{4}
   \drawwidebeam{4}{(B)}
 \end{optexp}
\end{pspicture}

\begin{pspicture}(3,2) 
  \pnode(0,1){A}\pnode(3,1){B}
  \begin{optexp}
  \lens[lens=0.5 0.5 0.5, abspos=0.5](A)(B)
  \lens[lens=4 4 2, abspos=1.5](A)(B)
  \addtopsstyle{Beam}{fillstyle=solid, fillcolor=green, opacity=0.3}
  \psset{loadbeampoints, savebeampoints}
  \drawwidebeam[beamwidth=0.2, stopinside]{(A)}{1}
  \drawwidebeam[beamdiv=-70]{1}{2}
  \drawwidebeam{2}{(B)}
  \end{optexp}
\end{pspicture}

\begin{pspicture*}(0,1.5)(7,5)
\lens[lens=6 6 6, n=2](0,2)(6,2)
\optplate[plateheight=4](3,2)(10,2)
\addtopsstyle{Beam}{linewidth=0.5\pslinewidth}
\multido{\r=-0.25+0.25}{3}{%
  \drawbeam[beamangle=0, beampos=\r]{(0,2)}{1}{2}
}%
\multido{\r=-0.25+0.25}{3}{%
  \drawbeam[linecolor=red, beamangle=15, beampos=\r]{(0,2)}{1}{2}
}%
\multido{\r=-0.25+0.25}{3}{%
  \drawbeam[linecolor=blue, beamangle=30, beampos=\r]{(0,2)}{1}{2}
}%
\end{pspicture*}

\begin{pspicture*}(0,1.5)(7,5)
\lens[lens=6 6 6, n=2](0,2)(6,2)
\optplate[plateheight=4](3,2)(10,2)
\addtopsstyle{Beam}{linewidth=0.5\pslinewidth}
\multido{\r=-0.15+0.3}{2}{%
  \drawbeam[beampos=\r]{(0,2)}{1}{2}
}%
\multido{\r=0.5+0.3}{2}{%
  \drawbeam[linecolor=red, beampos=\r]{(0,2)}{1}{2}
}%
\multido{\r=1.15+0.3}{2}{%
  \drawbeam[linecolor=blue, beampos=\r]{(0,2)}{1}{2}
}%
\end{pspicture*}

\begin{pspicture}[showgrid=true](5,3)
  \lens[n=2.0, lens=3 3 3](0,1)(5,1)
  \optplane[compname=AA](0,1)(0,1)
  \drawbeam[beampos=0.5]{AA}{1}{(5,2)}
\end{pspicture}
\end{document}
