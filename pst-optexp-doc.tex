\documentclass[%
11pt, english, parskip=false, headings=small,
headinclude=false, 
footinclude=false,oneside]{pst-doc}

\KOMAoptions{DIV=9}
\usepackage[latin1]{inputenc}
%
\usepackage{pst-func}
\usepackage{pst-optexp}
\let\verPstOptExp\fileversion
\let\datePstOptExp\filedate
\usepackage{pst-circ}
\usepackage{nicefrac}
\usepackage{longtable}
\usepackage{multicol}
\usepackage{multirow}
\usepackage{float}
\usepackage{prettyref}
\newrefformat{sec}{Sec.~\ref{#1}}
\lstset{%
  language=[LaTeX]TeX,
  texcsstyle = [20]\color{DOrange!60!black},
  moretexcs = [20]{lens, optbox, oenode, oenodein, oenodeext, oenodeout, oenoderefa, oenoderefb, optplate, optretplate, pinhole, crystal,optdetector, optdiode, doveprism, polarization, mirror, beamsplitter, optgrid, optprism, rightangleprism, pentaprism, optdipole, optripole, optfiber, optamp, optmzm, optfilter, polcontrol, optisolator, optswitch, fiberdelayline, optfiberpolarizer, fibercollimator, optcoupler, wdmcoupler, wdmsplitter, drawbeam, drawwidebeam, drawfiber, custombeam},
  explpreset={pos=l,width=-99pt,overhang=0pt,hsep=5mm, varwidth,vsep=\bigskipamount,rframe={}},
  escapechar=§
}
\colorlet{sectioncolor}{DOrange!80!black}
\usepackage{ltxdockit}
\colorlet{spot}{sectioncolor}
\InputIfFileExists{ltxdockit.cfg}{}{}
\makeatletter
\def\ltd@optionlist{%
  \let\optitem\poe@optitem
  \let\styleitem\poe@styleitem
  \let\valitem\poe@valitem
  \let\choitem\poe@choitem
  \let\boolitem\poe@boolitem
  \let\intitem\poe@intitem
  \let\numitem\poe@numitem}

\newcommand*{\poe@optitem}[3][]{%
  \xLkeyword{#2}%
  \ifblank{#1}
    {\ltd@option{#2}{#2}{#3}{}}
    {\ltd@option{#2}{#2}{#3}{\ltd@textverb{#1}}}}%

\newcommand*{\poe@styleitem}[2][]{%
  \xLstyle{#2}%
  \ifblank{#1}
    {\ltd@option{#2}{#2}{\prm{psstyle}}{}}
    {\ltd@option{#2}{#2}{\prm{psstyle}}{\ltd@textverb{#1}}}}%

\newcommand*{\poe@valitem}[3][]{%
  \xLkeyword{#2}%
  \ifblank{#1}
    {\ltd@option{#2}{#2}{\prm{#3}}{}}
    {\ltd@option{#2}{#2}{\prm{#3}}{\ltd@textverb{#1}}}}%

\newcommand*{\poe@choitem}[3][]{%
  \xLkeyword{#2}%
  \ifblank{#1}
    {\ltd@option{#2}{#2}{\ltd@verblist{#3}}{}}
    {\ltd@option{#2}{#2}{\ltd@verblist{#3}}{\ltd@textverb{#1}}}}%

\newcommand*{\poe@boolitem}[2][]{%
  \xLkeyword{#2}%
  \ifblank{#1}
    {\ltd@option{#2}{#2}{\ltd@verblist{true,false}}{}}
    {\ltd@option{#2}{#2}{\ltd@verblist{true,false}}{\ltd@textverb{#1}}}}%

\newcommand*{\poe@intitem}[2][]{%
  \xLkeyword{#2}%
  \ifblank{#1}
    {\ltd@option{#2}{#2}{\prm{integer}}{}}
    {\ltd@option{#2}{#2}{\prm{integer}}{\ltd@textverb{#1}}}}%
\newcommand*{\poe@numitem}[2][]{%
  \xLkeyword{#2}%
  \ifblank{#1}
    {\ltd@option{#2}{#2}{\prm{num}}{}}
    {\ltd@option{#2}{#2}{\prm{num}}{\ltd@textverb{#1}}}}%
%
% New commands
%
\newcommand*{\OptExpPackage}{\textsf{`pst-optexp'}}
\newcommand*{\nodename}[1]{\emph{#1}}
\newcommand*{\param}[1]{\normalfont\texttt{#1}}
\newcommand*{\paramvalue}[1]{\texttt{#1}}
\newcommand*{\defaultparam}[1]{\emph{default:} \paramvalue{#1}}
\newcommand*{\paramitem}[3]{\item[\param{#1}:] \paramvalue{#2} (\defaultparam{#3})}
\newcommand*{\styleitem}[2]{\item[\param{#1}:] \paramvalue{#2}}
\newcommand*{\styleshape}[1]{\texttt{#1}}
%\newcommand{\parampar}[1]{\marginpar{\Lkeyword{#1}}}
\newcommand*{\stylepar}[1]{\paragraph{\Lstyle{#1}}\xLkeyword{addto#1}\xLkeyword{new#1}}

\newcommand*{\nodedesc}[1]{\Largr{#1}}
\newcommand*{\nodedescin}{\nodedesc{In}}%
\newcommand*{\nodedescout}{\nodedesc{Out}}%

\def\Lstyle#1{\texttt{#1}\xLstyle{#1}}
\def\xLstyle#1{\index{#1@\texttt{#1}}\index{Style!#1@\texttt{#1}}}
\def\nxLstyle#1{\texttt{#1}}

\def\Ldipole#1{\nxLcs{#1}\xLdipole{#1}}
\def\xLdipole#1{\index{#1@\nxLcs{#1}}\index{Dipole object!#1@\nxLcs{#1}}}

\def\Ltripole#1{\nxLcs{#1}\xLtripole{#1}}
\def\xLtripole#1{\index{#1@\nxLcs{#1}}\index{Tripole object!#1@\nxLcs{#1}}}

\def\Lfdipole#1{\nxLcs{#1}\xLfdipole{#1}}
\def\xLfdipole#1{\index{#1@\nxLcs{#1}}\index{Fiber dipole object!#1@\nxLcs{#1}}}

\def\Lfmultipole#1{\nxLcs{#1}\xLfmultipole{#1}}
\def\xLfmultipole#1{\index{#1@\nxLcs{#1}}\index{Fiber multipole object!#1@\nxLcs{#1}}}

\newcommand{\dipoledesc}[1]{%
  \xLdipole{#1}\cmditem{#1}[Options](In)(Out){Label}%
}
\newcommand{\tripoledesc}[1]{%
  \xLtripole{#1}\cmditem{#1}[Options](In)(Center)(Out){Label}
}

\newcommand{\fiberdipoledesc}[1]{%
  \xLfdipole{#1}\cmditem{#1}[Options](In)(Out){Label}
}

\newcolumntype{T}{>{\ttfamily}l}
\newcolumntype{B}{>{\bfseries}l}
\newcommand{\refstringexplanation}[0]{%
  A \paramvalue{<ref string>} is any combination of \paramvalue{c}
  (center), \paramvalue{t} (top), \paramvalue{b} (bottom), \paramvalue{l}
  (left), \paramvalue{r} (right)}

\addtopsstyle{Fiber}{linecolor=DOrange,linewidth=1.5\pslinewidth}
\addtopsstyle{Beam}{linewidth=1.5\pslinewidth}

\makeatletter
\renewcommand\maketitle{%
\thispagestyle{empty}%
\begin{titlepage}
\begin{pspicture}(1.6in,0.685in)(10,21.7)
  \psframe[fillstyle=solid,linecolor=lightgray,fillcolor=lightgray,linestyle=solid](0,-5.75)(21.5,10)
  \psframe[fillstyle=solid,linecolor=Orange!85!Red,fillcolor=Orange!85!Red,linestyle=solid](0,10)(21.5,10.5)
  \psframe[fillstyle=solid,linecolor=Orange!85!Red,fillcolor=Orange!85!Red,linestyle=solid](0,21.1)(21.5,21.2)
  \rput[lb](3,22){\Huge\sffamily\color{Orange!65!Red}\psscalebox{2}{\textbf{PSTricks}}}
  \rput[lb](3,14.1){\parbox{15cm}{\sffamily\RaggedRight\bfseries\huge\@title}}
  \rput[lb](3,12.6){\parbox{13cm}{\sffamily\Large\@subtitle}}
  \rput[lb](3,7.6){\parbox{13cm}{\sffamily\@date}}
  \rput[lb](3,-2.6){\parbox[b]{17cm}{\sffamily\RaggedRight 
    \ifx\@docauthor\empty~\else Documentation by\fi\hfill\makebox[7cm][l]{Package author(s):}\\
    \ifx\@docauthor\empty~\else{\bfseries\tabular[t]{@{}l@{}}\@docauthor\endtabular}\fi\hfill\makebox[7cm][l]{%
      \bfseries\tabular[t]{@{}l@{}}\@author\endtabular}}}
 \rput[C](11,4){\bgImage}%
\end{pspicture}%
\end{titlepage}}
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 \title{\texttt{pst-optexp}\\ A PSTricks package to draw optical experimental setups\\ \small v.\verPstOptExp}
 \author{Christoph Bersch}
 \date{\datePstOptExp}
\def\bgImage{\psset{unit=1.3}
\begin{pspicture}[showgrid=false](-0.2,0.1)(8.2,5.3)
  \pnode(0,3){M1}
  \pnode(8,3){M2}
  \pnode(8,0.5){In}
  \pnode(6.5,0.5){Min}
  \pnode(6.5,3){Pin}
  \pnode(4.5,3){Min2}
  \pnode(1.5, 0.5){Mout}
  \pnode(1.5,3){Pout}
  \pnode(3.5,3){Mout2}
  \pnode(0,0.5){Out}
  \definecolor[ps]{bl}{rgb}{tx@addDict begin Red Green Blue end}%
  \addtopsstyle{Beam}{linecolor=bl, linejoin=1}
  \psset{mirrortype=extended, mirrordepth=0.15}
  \newpsstyle{ExtendedMirror}{linestyle=none, hatchwidth=0.5\pslinewidth, hatchsep=1.2\pslinewidth,%
                fillstyle=hlines}%
  \begin{optexp}
  \mirror[mirrorwidth=4, mirrorradius=10.4](M2)(M1)(M2){}
  \mirror[mirrorwidth=4, mirrorradius=10.4](M1)(M2)(M1){}
  \mirror(In)(Min)(Pin){}
  \optprism[n=1.85, addtoOptComp={linewidth=1.5\pslinewidth}](Min)(Pin)(Min2){}
  \mirror[compshift=0.4](Pin)(Min2)(Pin){}
  \mirror[compshift=-0.4](Pout)(Mout2)(Pout){}
  \optprism[n=1.85, compshift=0.15, linewidth=1.5\pslinewidth](Mout2)(Pout)(Mout){}
  \mirror(Pout)(Mout)(Out){}
  \multido{\i=0+1}{40}{%
    \pstVerb{%
      \i\space 650 400 sub 39 div mul 400 add 
      tx@addDict begin wavelengthToRGB end }%
    \drawbeam[nadd=-0.002 \i\space mul]{(In)}{3}{4}{5}{2}{1}{6}{7}{8}{(Out)}
  }%
  \newpsstyle{Beam}{linecolor=red}
  \bglayer{%
    \psline[style=Beam,ArrowInside=->, linewidth=2\pslinewidth, arrowinset=0](In)(\oenodein{3})(\oenodeout{4})
  }
  \drawbeam[startvec=0.005,startpos=0.1, addtoBeam={arrows=<-, linewidth=2\pslinewidth, arrowinset=0}]{([Xnodesep=-0.2]Out)}{8}{7}
\end{optexp}
\rput(4,4.5){%
  \psframe[fillstyle=solid,fillcolor=gray!70](-0.1, -0.6)(0.1, 0.7)
  \multido{\r=-0.5+0.1}{12}{%
    \psline[linewidth=0.5\pslinewidth](-0.1,\r)(0.1,\r)
  }%
}%
\end{pspicture}}
\begin{document}
\maketitle

\clearpage
\tableofcontents
\clearpage

\section{Introduction}
The package \LPack{pst-optexp} is a collection of optical components
that facilitate easy sketching of optical experimental
setups. Mechanisms for proper alignment of different components are
provided internally. This way the user does not have to care for proper
orientation of the elements. Macros for convenient definition of new 
user-defined components are also provided.

\section{Backward compatibility}

\begin{optionlist}
\optitem[new]{namingscheme}{old, new}
Version 3.0 introduced a lot of advanced features which made it too difficult to
maintain full backward compatibility with version 2.x. However, using the
\Loption{compat} package option allows you to compile old setups but without
profiting from the new features. If you only need the old naming scheme, because
you accessed internal nodes directly, then you must only set
\nxLkeyword{namingscheme=old}.
\end{optionlist}


\section{Concept and General Behavior}\label{sec:general}

This section introduces into the basic concepts of the package design and
explains the parameters and commands which are supported by most optical
objects.

\subsection{Concept}

The objects provided by \LPack{pst-optexp} can be differentiated into
two different categories: free-ray and fiber-optical objects.

The free-ray units are subdivided in two different kinds: dipoles which
require two reference points for alignment and do not alter the
direction of passing light beams (e.g. lenses and retardation plates)
and tripoles which work in reflection and require three reference points
(mirrors, gratings, beamsplitters etc.).

For free-ray setups one usually has a few straight light paths in which
several different objects are to be arranged. In this case it is very
convenient to define only two nodes for each light path. The objects are
placed on this light path using the different positioning parameters
(see \prettyref{sec:positioning}) of the package. After having arranged
everything, the beams themselves are drawn (see \prettyref{sec:connecting}).

The fiber-optical objects can be classified as dipoles, tripoles and quadrupoles
which have a corresponding number of fiber connections. Their handling differs
in some aspects from the free-ray objects. The fiber optics are directly
connected to the reference nodes. Every input and output fiber can be flexibly
customized for each object (see \prettyref{sec:styles}). Positioning of the
fiber dipoles is handled equivalently to the free-ray dipoles. Tripoles and
quadrupoles can be found only as different coupler types. Their positioning
mechanisms are a bit more involved and explained in the respective section
(\prettyref{sec:coupler}).

Some hybrid dipoles (optbox, detector etc.) can be used both as
fiber-optical or free-ray elements. 

\subsection{General Settings}

Some generic parameters which can be used for all objects.

\begin{optionlist}
\numitem[0]{angle}
Rotate an object by \nxLkeyword{angle} degrees.

\boolitem[false]{optional}
\styleitem{OptionalStyle}
Can be used with every object and marks it as optional. The style of an
optional element can be configured by changing the style
\nxLkeyword{OptionalStyle}.

\begin{LTXexample}
\begin{pspicture}(3,1.5)
\lens[optional, beam](0,1)(3,1){L}
\end{pspicture}
\end{LTXexample}

\boolitem[false]{showoptdots}
Draw some internal nodes which are used to place the object and the
label. The black points are used for positioning, the red points mark
the label references.

\begin{LTXexample}
\begin{pspicture}(3,2)
\mirror[showoptdots,
          beam](0,1)(1.9,1)(1.9,0){mirror}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Using PSStyles}\label{sec:styles}

The appearance of many functional parts of \LPack{pst-optexp} objects is
controlled via psstyles. These are collections of parameters which are
applied only to selected subparts of the objects. In general, these
psstyles can be overwritten with the \Lcs{newpsstyle} macro and extended
with the \Lcs{addtopsstyle} macro.

\begin{optionlist}
\styleitem{OptComp}
Affects only the appearence of the optical
components. This was introduced, because using only the standard
graphics parameters changes also the connections that are drawn within
the component.

\begin{LTXexample}
\begin{pspicture}(3,4)
  \psset{beam}
  % wrong, also beam width is changed
  \mirror[linewidth=3\pslinewidth]%
         (0,3)(2,3)(2,2){mirror}
  % correct result
  \mirror[addtoOptComp={linewidth=3\pslinewidth}]%
         (0,1)(2,1)(2,0){mirror}
\end{pspicture}
\end{LTXexample}

\styleitem{OptionalStyle}
\end{optionlist}

\subsection{Positioning}\label{sec:positioning}
\begin{optionlist}
  \numitem{position} Equivalent to the \Lkeyword{npos} parameter of
  \Lcs{ncput} (a number in the range $0-1$) and controls the relative position
  of object between the two reference points. It is available for all components
  but the free-ray tripoles.

\begin{LTXexample}
\begin{pspicture}(3,1.5) 
  \lens[beam, position=0.8](0,1)(3,1){L}
\end{pspicture}
\end{LTXexample}

\numitem{abspos}
The parameter \Lkeyword{abspos} allows absolute positioning between the
two reference nodes.

\begin{LTXexample}
\begin{pspicture}(3,1.5) 
  \lens[beam, abspos=1](0,1)(3,1){L}
\end{pspicture}
\end{LTXexample}

\numitem[0]{compshift}

\begin{LTXexample}
\begin{pspicture}(3,2) 
  \lens[compshift=0.1, n=1](0,1)(3,1){L}
  \addtopsstyle{Beam}{startvecabs, startvec=1 0}
  \drawbeam{(0,1)}{}{(3,1)}
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}
\begin{pspicture}(3,2) 
  \mirror[beam, compshift=0.2, startvecabs, startvec=1 0, labelangle=45](0,1)(2,1)(2,0){mirror}
\end{pspicture}
\end{LTXexample}
\end{optionlist}


\subsection{Labels}\label{sec:labels}

\begin{optionlist}
\numitem[0.8]{labeloffset}
Specify the offset from the label reference node of the object which in most
cases is the center.

\valitem[\nxLcs{small}]{labelstyle}{macros}
Define the textstyle that is used to typeset the label. 

\valitem[c]{labelalign}{refstring}
Has the same meaning as the refpoint of \Lcs{rput} and can take the same values.

\numitem[0]{labelangle}
Set the label rotation angle around the object. \nxLkeyword{labelref} can be used to change the reference system.

\choitem[relgrav]{labelref}{relative, relgrav, global}
Set the reference coordinate system for the \nxLkeyword{labelangle} and the orientation of
the label text. The detailed behaviour is best illustrated looking at
the following three examples.

\medskip

\begin{LTXexample}
\begin{pspicture}(-2,-2)(2.5,2)
  \psset{endbox, optboxwidth=1, optboxheight=0.6}
  \multido{\i=0+45}{8}{%
    \optbox[label=0 . . relative](0,0)(1;\i){\i}
  }
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}
\begin{pspicture}(-2,-2)(2.5,2)
  \psset{endbox, optboxwidth=1, optboxheight=0.6}
  \multido{\i=0+72}{5}{%
    \optbox[labelref=relgrav](0,0)(1;\i){\i}
  }
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}
\begin{pspicture}(-2,-2)(2.5,2)
  \psset{endbox, optboxwidth=1, optboxheight=0.6}
  \multido{\i=0+72}{5}{%
    \optbox[labelref=global](0,0)(1;\i){\i}
  }
\end{pspicture}
\end{LTXexample}

\medskip

\optitem{label}{\prm{offset}[ \prm{angle}[ \prm{ref string}[ \prm{labelref}]]]}
Allows simplified notation for changing more than one
label-related parameter. It takes up to four space-separated arguments
(\nxLkeyword{labeloffset}, \nxLkeyword{labelangle}, \nxLkeyword{labelalign}, and
\nxLkeyword{labelref}). Unchanged intermediate arguments may be specified with a dot.

\medskip

\begin{LTXexample}
\begin{pspicture}(0,0)(4,3)
  \psset{endbox, beam}
  \optbox[label=0.7](1.5,2.5)(2.5,2.5){label}
  \optbox[label=1 -45](1.5,1)(2.5,1){$-45$}
  \optbox[label=0 . . relative]%
         (0.6,0.6)(0.6,1.6){relative}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Accessing Objects and Special Nodes}\label{sec:objnodes}

Every \nxLPack{pst-optexp} object of an experimental setup provides several
special nodes which are related to the geometry and the positioning of the
component. These are useful for related positioning and drawing.

\subsubsection{Object Names}\label{sec:namingobj}
All objects are numbered automatically in increasing order by their definition
in the code. The objects as well as their special nodes can be accessed via this
number.

\begin{optionlist}
  \valitem{compname}{string} This parameter can be used to assign a unique
  name instead of the automatic number to an object. It can be used only
  directly within a \nxLPack{pst-optexp} object and must be unique within one
  \nxLkeyword{pspicture} environment.

\medskip

\begin{lstlisting}
\optbox[compname=MyBox](A)(B){Box} % valid use of 'compname'
\psset{compname=MyName}            % not valid, gives an error
\end{lstlisting}
\end{optionlist}

\subsubsection{Accessing Internal Nodes}\label{sec:internalnodes}

Every object defines several special internal nodes which are very useful for
related positioning and drawing. You should always use the provided \nxLcs{oenode*}
macros to access the node names.

\begin{ltxsyntax}
\cmditem{oenode}{Obj}{Node}

This is the basic command which takes as first argument the name of the
target object (for naming see \ref{sec:namingobj}) and as second argument the
name of the requested special node. For most special nodes an appropriate macro is provided.

\cmditem{oenoderefa}{Obj}
\cmditem{oenoderefb}{Obj}

These commands refer to the reference nodes which are used to position \prm{Obj}. For the
dipole components they are identical with the nodes passed to the component
macro:

\medskip
\begin{LTXexample}
\begin{pspicture}(3,2)
  \pnode(0,1){A}\pnode(3,1){B}\lens[showoptdots](A)(B){}
  \psdot[linecolor=red](\oenoderefa{})
  \psdot[linecolor=red, dotstyle=x, dotsize=0.2](A)
  \psdot[linecolor=blue](\oenoderefb{})
  \psdot[linecolor=blue, dotstyle=x, dotsize=0.2](B)
\end{pspicture}
\end{LTXexample}
\medskip

For tripole macros, new reference nodes are constructed which lay in the plane of refraction:

\medskip
\begin{LTXexample}
\begin{pspicture}(3,4)
  \pnode(0,2){A}\pnode(2,0){B}\pnode(2,2){G}
  \mirror[showoptdots](A)(G)(B){}
  \psdot[linecolor=red](\oenoderefa{})
  \psdot[linecolor=red, dotstyle=x, dotsize=0.2](A)
  \psdot[linecolor=blue](\oenoderefb{})
  \psdot[linecolor=blue, dotstyle=x, dotsize=0.2](B)
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\subsection{Nodes For External Usage}\label{sec:extnode}

Some of the objects can provide a supplementary node for additional
connections. A laser diode may be connected for example to a frequency synthesizer
(use package \LPack{pst-circ}) or a detector to a computer.

\begin{optionlist}
\valitem{extnode}{refstring}

Controls the position of the additional node and
takes a \paramvalue{<ref string>} as its argument. By default this
parameter is empty (\paramvalue{\{\}}) and no node is created.

The name of the new node depends on the \Lkeyword{compname} parameter
(see Sec.~\ref{sec:namedobj} for naming conventions). If \nxLkeyword{compname} is empty
the new node is named \nodename{ExtNode} by default and overwritten by
following objects.

Table.~\ref{tab:nodes} shows all objects which provide an external
node. Some allow any possible \paramvalue{<ref string>} for \Lkeyword{extnode}, others have
only one reasonable possibility (e.g. piezo mirror, see
Sec.~\ref{sec:mirror}) which does not depend on the actual value of \Lkeyword{extnode}.

\bigskip

\begin{LTXexample}[pos=t, vsep=8mm]
\begin{pspicture}[showgrid=true](11,3) 
   \psset{beam, beamInside=false, labelangle=-90, labeloffset=0.3}
   \optbox[extnode=tl](0,2.5)(3,2.5){\texttt{tl}}\psdot(\oenodeext{})
   \optbox[extnode=l](0,1.5)(3,1.5){\texttt{l}}\psdot(\oenodeext{})
   \optbox[extnode=bl](0,0.5)(3,0.5){\texttt{bl}}\psdot(\oenodeext{})
   \optbox[extnode=t](4,2.5)(7,2.5){\texttt{t}}\psdot(\oenodeext{})
   \optbox[extnode=c](4,1.5)(7,1.5){\texttt{c}}\psdot(\oenodeext{})
   \optbox[extnode=b](4,0.5)(7,0.5){\texttt{b}}\psdot(\oenodeext{})
   \optbox[extnode=tr](8,2.5)(11,2.5){\texttt{tr}}\psdot(\oenodeext{})
   \optbox[extnode=r](8,1.5)(11,1.5){\texttt{r}}\psdot(\oenodeext{})
   \optbox[extnode=br](8,0.5)(11,0.5){\texttt{br}}\psdot(\oenodeext{})
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\newpage

\section{Free-Ray Objects}

The general appearance of all objects can be customized using the
standard PSTricks parameter like \Lkeyword{linewidth}
or \Lkeyword{fillstyle}. Some components allow changing a special part
(e.g. for a piezo mirror) for which they use certain psstyles. For the
automatic beam connections the \styleshape{Beam} style is used.

\subsection{Lens}\label{sec:lens}

\begin{ltxsyntax}
\dipoledesc{lens}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
\lens[beam](0,1)(3,1){L}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[1]{lensheight} Set the height of the lens.
\begin{LTXexample}
\begin{pspicture}(3,1.5)
\lens[beam](0,1)(3,1){L1}
\lens[lensheight=0.5](2,1)(3,1){L2}
\end{pspicture}
\end{LTXexample}

\numitem[1]{lensradiusleft} Set the left radius of the lens. A positive
\prm{num} is for convex, a negative one for concave curvatures. Use zero for a plain
surface.

\numitem[1]{lensradiusright} Same as \opt{lensradiusleft} but for the right surface.

\medskip
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \psset{lensradiusright=0}
  \lens[lensradiusleft=1, beam](0,1)(3,1){L1}
  \lens[lensradiusleft=-1](2,1)(3,1){L2}
\end{pspicture}
\end{LTXexample}

\numitem{lensradius} A convenience option to specify both curvatures.

\medskip
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \lens[lensradius=-2, beam](0,1)(3,1){L1}
\end{pspicture}
\end{LTXexample}

\numitem[0]{lenswidth}

Usually only the height and the two radii are used to construct the lens and the
width is calculated from these parameters. If \opt{lenswidth} is greater than
zero, this width is used instead. This is only useful if you want to draw thick
lenses and it can have ugly results if the lens width is choosen too small.

\medskip
\begin{LTXexample}
\begin{pspicture}(3,2)
  \lens[lenswidth=0.5, beam](0,1)(2,1){thicklens}
  \lens[lenswidth=0.1, beam](2,1)(3,1){}
\end{pspicture}
\end{LTXexample}


\optitem{lens}{\prm{leftR} [\prm{rightR} [\prm{height} [\prm{width}]]]}
A convenience option to specify all lens parameters with a single option.

\medskip
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \lens[lens=1](0,1)(1,1){L1}
  \lens[lens=-2 1, beam](0,1)(3,1){L2}
  \lens[lens=1 -0.5 0.7](2,1)(3,1){L3}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Optical Plate}

\begin{ltxsyntax}
\dipoledesc{optplate}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optplate[beam](0,1)(3,1){filter}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
  \numitem[1]{plateheight} The height of the plate.

  \optitem[2\nxLcs{pslinewidth}]{platelinewidth}{\prm{num} or \prm{dimen}} The linewidth of the
  plate. This could be defined also with the generic \opt{linewidth} option,
  possibly inside the \opt{OptComp} style. But using \opt{platelinewidth} allows
  to globally change the linewidth of all \nxLcs{optplate} objects.

\numitem[0]{angle} Rotate the plate around its center.
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optplate[angle=10, beam](0,1.2)(3,1.2){glass plate}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Retardation Plate}

\begin{ltxsyntax}
\dipoledesc{optretplate}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optretplate[beam](0,1)(3,1){$\nicefrac{\lambda}{2}$}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[1]{plateheight} The height of the plate.
\numitem[0.1]{platewidth} The width of the plate.
\end{optionlist}

\subsection{Pinhole}

\begin{ltxsyntax}
\dipoledesc{pinhole}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \pinhole[beam](0,1)(3,1){PH}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[1]{outerheight}
\numitem[0.1]{innerheight}
\optitem[2\nxLcs{pslinewidth}]{phlinewidth}{\prm{num} or \prm{dimen}}
The linewidth of the pinhole. This could be defined also with the generic \opt{linewidth} option,
possibly inside the \opt{OptComp} style. But using \opt{phlinewidth} allows
to globally change the linewidth of all \nxLcs{pinhole} objects.

\numitem[0]{phwidth} The pinhole is drawn in a more plastic style if the
\nxLkeyword{phwidth} is not zero.

\medskip
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \pinhole[beam, phwidth=-0.1](0,1)(3,1){PH}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Crystal}\label{sec:crystal}

\begin{ltxsyntax}
\dipoledesc{crystal}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
\crystal[beam](0,1)(3,1){Crystal}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[1.4]{crystalwidth}
\numitem[0.6]{crystalheight}
\numitem[0.6]{caxislength}
\boolitem[false]{caxisinv}
\styleitem{CrystalCaxis}
\boolitem[false]{voltage}
\boolitem[false]{lamp}
\numitem[0.3]{lampscale}
\numitem[0]{angle}
\valitem[c]{rotateref}{refstring}
\end{optionlist}

\noindent For a discussion of the \Lkeyword{angle} and \Lkeyword{rotateref}
parameters see Sec.~\ref{sec:box} about boxes.  \medskip

\begin{LTXexample}
\begin{pspicture}(3,2)
\crystal[fillstyle=solid, fillcolor=yellow!90!black, 
           label=1.2 -45, voltage, 
           lamp, beam](0,1)(3,1){SBN:Ce}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Box}\label{sec:box}

\begin{ltxsyntax}
\dipoledesc{optbox}
\begin{LTXexample}
\begin{pspicture}(3,2)
  \optbox[beam](0,0)(3,2){box}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[0.8]{optboxheight}
\numitem[1.4]{optboxwidth}
\boolitem[false]{endbox}
\begin{LTXexample}
\begin{pspicture}(3,2)
  \optbox[beam, endbox, label=0 . . relative]%
           (0,0)(1.5,1){box}
\end{pspicture}
\end{LTXexample}

\numitem[0]{angle}
\numitem[c]{rotateref}{refstring}
The parameter \Lkeyword{angle} describes the tilt of the box
relative to the reference line defined by the two reference nodes. The
reference point for the rotation can be defined
with \Lkeyword{rotateref} which can take any combination
of \paramvalue{c}, \paramvalue{t}, \paramvalue{b}, \paramvalue{l}
and \paramvalue{r} (compare with \Lkeyword{extnode} in
Sec.~\ref{sec:extnode}). Note, that all connection-related nodes are
also rotate, while the label is not affected.

\medskip

\begin{LTXexample}
\begin{pspicture}(3,2)
  \optbox[angle=20, beam, rotateref=l, 
            labeloffset=0.5](0,1)(3,1){box}
\end{pspicture}
\end{LTXexample}

\numitem{refractiveindex}
Together with the parameter \Lkeyword{refractiveindex} this
can be exploited to sketch the refraction through a tilted homogeneous
medium (e.g. a glass plate). Then, however, the reference nodes for the
beam connection must be corrected which is rather easy using the outer
nodes of the object as coordinate references and the \texttt{|} node
operator.

\medskip

\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \pnode(0,1){A}\pnode(3,1){B}
  \optbox[labeloffset=0.8, optboxwidth=0.5, optboxheight=1, angle=20, n=2.3, compname=Box](A)(B){glass plate}
  \drawbeam{(A|\oenodein{Box})}{Box}
  \drawbeam{Box}{(B|\oenodeout{Box})}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Detector}

\begin{ltxsyntax}
\dipoledesc{optdetector}
\begin{LTXexample}
\begin{pspicture}(3,1.2)
  \optdetector[beam](0,0)(1.5,1){detector}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
  \numitem[0.8]{detsize} For a \opt{round} detector this is the object
  diameter, for the \opt{diode} detector its side length.

\choitem[round]{dettype}{round, diode} This parameter selects between different
types of detectors.
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optdetector[beam, dettype=diode](0,0)(1.5,1){detector}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Optical Diode}\label{sec:optdiode}


\begin{ltxsyntax}
\dipoledesc{optdiode}
\begin{LTXexample}
\begin{pspicture}(3,2)
   \optdiode[beam, beamInside=false](0,1)(3,1){Diode}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}
\begin{optionlist}
\numitem[0.8]{optdiodesize}
\end{optionlist}

\subsection{Dove Prism}\label{sec:doveprism}

\begin{ltxsyntax}
\dipoledesc{doveprism}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \doveprism[beam](0,1)(3,1){Dove}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
  \numitem[0.6]{doveprismsize} The height of the prism, the total width is
  three times the height and the angles at the input and output faces are
  45\textdegree.
\end{optionlist}
\medskip

\subsection{Polarization}

\begin{ltxsyntax}
\xLdipole{polarization}\cmditem{polarization}[Options](In)(Out)
\begin{LTXexample}
\begin{pspicture}(3,1)
  \polarization[beam](0,0.5)(3,0.5)
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}
\begin{optionlist}
\choitem[parallel]{poltype}{parallel, perp, misc, lcirc, rcirc}
\numitem[0.6]{polsize}
\optitem[0.7\nxLcs{pslinewidth}]{pollinewidth}{\prm{num} or \prm{dimen}}
\begin{LTXexample}
\begin{pspicture}(3,5)
  \psset{beam}
  \begin{optexp}
  \polarization[poltype=parallel, 
                  abspos=0.5](0,4.5)(3,4.5)
  \polarization[poltype=perp, abspos=1](0,3.5)(3,3.5)
  \polarization[poltype=misc, abspos=1.5](0,2.5)(3,2.5)
  \polarization[poltype=lcirc, abspos=2](0,1.5)(3,1.5)
  \polarization[poltype=rcirc, 
                  abspos=2.5](0,0.5)(3,0.5)
  \end{optexp}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Mirror}\label{sec:mirror}

\begin{ltxsyntax}
\tripoledesc{mirror}
\begin{LTXexample}
\begin{pspicture}(3,2)
  \mirror[beam](0,0)(1.8,1.5)(0,2){M}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[1]{mirrorwidth}
The width of the mirror.

\optitem[2\nxLcs{pslinewidth}]{mirrorlinewidth}{\prm{num} or \prm{dimen}} The linewidth of the
mirror. This could be defined also with the generic \opt{linewidth} option,
possibly inside the \opt{OptComp} style. But using \opt{mirrorlinewidth} allows
to globally change the linewidth of all \nxLcs{mirror} objects.

\numitem[0]{mirrorradius} This parameter defines the curvature of the mirror. A
value of \opt{0} is for a plain mirror, a negative radius for a concave mirror
and a positive radius gives you a convex mirror.

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)
  \psset{labeloffset=0.5}
  \mirror[mirrorradius=1](0,0)(1,2)(1.8,1){concave}
  \mirror[mirrorradius=-1](1,2)(1.8,1)(2.5,3){convex}
  \drawbeam{(0,0)}{1}{2}{(2.5,3)}
\end{pspicture}
\end{LTXexample}

\choitem[normal]{mirrortype}{normal, piezo, extended}

The \nxLkeyword{mirrortype} selects between different types of mirrors. Note, when using \Lkeyword{extnode} with a
piezo mirror, the default piece of wire is omitted.

\begin{LTXexample}
  \begin{pspicture}(3,2)
  \mirror[mirrortype=extended,
            beam](0,0)(1.8,1.5)(0,2){ext}
\end{pspicture}
\end{LTXexample}
\medskip
\begin{LTXexample}
  \begin{pspicture}(3,2)
  \mirror[mirrortype=piezo,
            beam](0,0)(1.8,1.5)(0,2){piezo}
\end{pspicture}
\end{LTXexample}

\styleitem{ExtendedMirror} This style defines the appearance of the extended mirror.
\begin{LTXexample}
\begin{pspicture}(3,2)
  \newpsstyle{ExtendedMirror}{fillstyle=solid, 
                                fillcolor=gray!50,
                                linestyle=none}
  \mirror[mirrortype=extended,
            beam](0,0)(1.8,1.5)(0,2){ext}
\end{pspicture}
\end{LTXexample}

\styleitem{PiezoMirror} This style defines the appearance of the piezo
mirror. This can also be used to change the size of piezo part, as shown in the
examples.
\begin{LTXexample}
\begin{pspicture}(3,2)
  \addtopsstyle{PiezoMirror}{xunit=2}
  \mirror[mirrortype=piezo,
            beam](0,0)(1.8,1.5)(0,2){piezo}
\end{pspicture}
\end{LTXexample}

\boolitem[false]{variable}

\styleitem{VariableMirror} With the \opt{variable} option a moveable
mirror is drawn which has two additional curved arrows on both sides. The style
of the arrows can be changed with the \opt{VariableMirror} style.
\begin{LTXexample}
\begin{pspicture}(3,2)
  \mirror[beam, variable](0,0)(1.8,1.5)(0,2){var}
\end{pspicture}
\end{LTXexample}

\numitem[0.1]{mirrordepth} Define the depth of an extended mirror
\begin{LTXexample}
\begin{pspicture}(3,2)
  \mirror[mirrortype=extended, mirrordepth=0.2,
            beam](0,0)(1.8,1.5)(0,2){}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Beamsplitter}

\begin{ltxsyntax}
\tripoledesc{beamsplitter}
\begin{LTXexample}
\begin{pspicture}(3,2)
  \beamsplitter[beam](0,1)(2,1)(2,0){BS}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[0.8]{bssize}

\choitem[cube]{bsstyle}{cube, plate} This parameter selects between different
types of beamsplitters. Note that although the \opt{plate} beamsplitter looks
like a mirror it has a different behavior for beam drawing.
\begin{LTXexample}
\begin{pspicture}(3,2)
  \beamsplitter[bsstyle=plate, beam](0,1)(2,1)(2,0){BS}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Optical Grid}

\begin{ltxsyntax}
\tripoledesc{optgrid}
\begin{LTXexample}
\begin{pspicture}(3,2)
  \optgrid[beam](0,2)(1.8,1.5)(0,0){grid}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}
\begin{optionlist}
\numitem[1]{optgridwidth} The width of the grating.

\numitem[0.15]{optgridheight} This is the total height of the grating.

\numitem[0.075]{optgriddepth} This is the modulation depth of the grating structure. The total height is unaffected by this value.
\begin{LTXexample}
\begin{pspicture}(3,2)
  \optgrid[optgriddepth=0.05, 
             beam](0,2)(1.8,1.5)(0,0){grid}
\end{pspicture}
\end{LTXexample}

\intitem[10]{optgridcount} The number of grating grooves.
\begin{LTXexample}
\begin{pspicture}(3,2)
  \optgrid[optgridcount=3, 
             beam](0,2)(1.8,1.5)(0,0){grid}
\end{pspicture}
\end{LTXexample}

\choitem[blazed]{optgridtype}{blazed, binary} Select between a \opt{binary} and a \opt{blazed} grating.
\begin{LTXexample}
\begin{pspicture}(3,2)
  \optgrid[optgridtype=binary, 
             beam](0,2)(1.8,1.5)(0,0){grid}
\end{pspicture}
\end{LTXexample}

\boolitem[false]{reverse} Reverse the slope of the grooves of the \opt{blazed} grating.
\begin{LTXexample}
\begin{pspicture}(3,2)
  \optgrid[reverse, beam](0,2)(1.8,1.5)(0,0){grid}
\end{pspicture}
\end{LTXexample}

\optitem[0.7\nxLcs{pslinewidth}]{optgridlinewidth}{\prm{num} or \prm{dimen}} The linewidth of the
grating. This could be defined also with the generic \opt{linewidth} option,
possibly inside the \opt{OptComp} style. But using \opt{optgridlinewidth} allows
to globally change the linewidth of all \nxLcs{optgrid} objects.
\end{optionlist}

\subsection{Prism}\label{sec:prism}

\begin{ltxsyntax}
\tripoledesc{optprism}
\begin{LTXexample}
\begin{pspicture}(3,2)
  \optprism[beam](0,1)(2,1)(3,0){Prism}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}
The prism is always placed symmetric between \prm{In} and \prm{Out} nodes. For
asymmetric beam traces see \prettyref{sec:connecting}.

\begin{optionlist}
\numitem[1]{prismsize} This is the height of the prism.
\numitem[60]{prismangle}
\begin{LTXexample}
\begin{pspicture}(3,2)
  \optprism[prismangle=30, beam](0,1)(2,1)(3,0){Prism}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Right-Angle Prism}\label{sec:raprism}

\begin{ltxsyntax}
\tripoledesc{raprism}
\begin{LTXexample}
\begin{pspicture}(3,2)
  \psdot(1.8,1)
  \rightangleprism[beam](0,1.5)(1.8,1)(0,0.5){RA}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}
The right-angle prisms is constructed such that the incoming and outcoming beam
are parallel and the \prm{Center} node is vertically centered in the
prism.
\begin{LTXexample}
\begin{pspicture}(3,2)
  \psdot(1.8,1.2)
  \rightangleprism[beam](0,1.5)(1.8,1.2)(0,0.5){RA}
\end{pspicture}
\end{LTXexample}

\begin{optionlist}
\numitem[1.5]{raprismsize} This is the length of the input plane.
\end{optionlist}

\subsection{Penta Prism}\label{sec:ppprism}

\begin{ltxsyntax}
\tripoledesc{pentaprism}
\begin{LTXexample}
\begin{pspicture}(3,2)
  \pentaprism[beam](0,1)(2,1)(2,0){PP}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
  \numitem[0.7]{pentaprismsize} This is the length of the input and output plane.
\end{optionlist}

\subsection{Custom Components}\label{sec:custom}
\nxLPack{pst-optexp} provides two commands which can use anything as optical
components. If you want to use a custom component more often, you should define
it as a new component. For details on how to define your own components see
\prettyref{sec:newobj}.

\begin{ltxsyntax}
  \dipoledesc{optdipole}
\begin{LTXexample}
\begin{pspicture}(3,3)
  \optdipole[labeloffset=1, beam](0,2)(3,1){%
    \rput(0,0){%
      \includegraphics[scale=0.25]{parque-nacional}
    }
  }{label}
\end{pspicture}
\end{LTXexample}

\tripoledesc{opttripole}
\begin{LTXexample}
\begin{pspicture}(3,3)
  \pnode(0,0){A}
  \pnode(1.5,2){G}
  \pnode(3,1.5){B}
  \opttripole[beam](3,1.5)(1.5,2)(0,0){%
    \rput[b](0,0){text}
  }{label}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\section{Fiber-Optical Objects}

\subsection{Fiber}

\begin{ltxsyntax}
\fiberdipoledesc{optfiber}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \psset{labeloffset=0.3}
  \optfiber(0,0.5)(3,0.5){SSMF}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\intitem[3]{fiberloops} 
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \psset{labeloffset=0.3}
  \optfiber[fiberloops=2](0,0.5)(3,0.5){SSMF}
\end{pspicture}
\end{LTXexample}

\numitem[0.4]{fiberloopradius}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \psset{labeloffset=0.3}
  \optfiber[fiberloopradius=0.2](0,0.5)(3,0.5){SSMF}
\end{pspicture}
\end{LTXexample}

\numitem[0.3]{fiberloopsep}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \psset{labeloffset=0.3}
  \optfiber[fiberloopsep=0.6](0,0.5)(3,0.5){SSMF}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Amplifier}

\begin{ltxsyntax}
\fiberdipoledesc{optamp}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optamp(0,1)(3,1){EDFA}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[0.8]{optampsize} The length of all triangle sides.
\end{optionlist}

\subsection{Mach-Zehnder Modulator}

\begin{ltxsyntax}
\fiberdipoledesc{optmzm}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optmzm(0,1)(3,1){MZM}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[0.8]{optmzmsize} This is the height of the component, the width
is \opt{1.6} times the height. Use the \opt{unit} parameter to change this
relation.
\end{optionlist}

\subsection{Filter}

\begin{ltxsyntax}
\fiberdipoledesc{optfilter}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optfilter(0,1)(3,1){bandpass}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[0.8]{filtersize}
\choitem[bandpass]{filtertype}{bandpass, bandstop, lowpass, highpass}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optfilter[filtertype=bandstop](0,1)(3,1){bandstop}
\end{pspicture}
\end{LTXexample}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optfilter[filtertype=lowpass](0,1)(3,1){lowpass}
\end{pspicture}
\end{LTXexample}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optfilter[filtertype=highpass](0,1)(3,1){highpass}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Polarization Controller}

\begin{ltxsyntax}
\fiberdipoledesc{polcontrol}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \polcontrol(0,1)(3,1){PC}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[0.15]{polcontrolsize} The radius of the polarization controller circles.
\end{optionlist}

\subsection{Isolator}

\begin{ltxsyntax}
\fiberdipoledesc{optisolator}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optisolator(0,1)(3,1){isolator}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
  \numitem[0.6]{isolatorsize} The height of the isolator. The width is \opt{1.6}
  times this value. Use the \opt{unit} parameter to change this relation.

\styleitem{IsolatorArrow} This changes the appearance of the isolator
arrow. This can be especially useful to adapt the length of the arrow.
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \addtopsstyle{IsolatorArrow}{xunit=1.2, 
                                 arrowinset=0.1}
  \optisolator(0,1)(3,1){isolator}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Optical Switch}

\begin{ltxsyntax}
\fiberdipoledesc{optswitch}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optswitch(0,1)(3,1){Opened switch}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[0.8]{switchsize}

\choitem[opened]{switchstyle}{opened, closed} Indicate the switch as \opt{opened} or \opt{closed}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optswitch[switchstyle=closed](0,1)(3,1){Closed switch}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsection{Fiber Delay Line}

\begin{ltxsyntax}
\fiberdipoledesc{fiberdelayline}
\begin{LTXexample}
\begin{pspicture}](3,1.5)
  \fiberdelayline(0,1)(3,1){Delay line}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[0.6]{fdlsize}
\styleitem{FdlArrow} This changes the appearance of the delay line arrow
and of the arrow type. This can be especially useful to adapt the length of the
arrow which may not be appropriate depending on the \opt{fdlsize} or to reverse
the arrow.
\begin{LTXexample}
\begin{pspicture}](3,1.5)
  \addtopsstyle{FdlArrow}{xunit=-1}
  \fiberdelayline(0,1)(3,1){Delay line}
\end{pspicture}
\end{LTXexample}
\end{optionlist}


\subsection{Fiber Polarizer}

\begin{ltxsyntax}
\fiberdipoledesc{optfiberpolarizer}
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optfiberpolarizer(0,1)(3,1){polarizer}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
  \numitem[0.6]{fiberpolsize}
\end{optionlist}

\subsection{Fiber Collimator}

\begin{ltxsyntax}
\xLcs{fibercollimator}\cmditem{fibercollimator}(In)(A)(B)(Out){Label}%
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \fibercollimator[beam](0,1)(3,1){FC}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}
\begin{optionlist}
\numitem[0.3]{fibercolsize}
\end{optionlist}
The \nxLcs{fibercollimator} can be used with two, three or four points. With two points, the collimator is placed like any other dipole component between \prm{In} and \prm{Out} node. For three nodes, the fiber is drawn as \Lcs{psbezier} curve for which the
central node \prm{A} is used twice. Positioning parameters can be used to
shift the object between \prm{In} and \prm{A} nodes.

\medskip

\begin{LTXexample}
\begin{pspicture}(3,2)
   \fibercollimator[beam](0,1)(2,1)(3,2){FC}
\end{pspicture}
\end{LTXexample}

\medskip

For four nodes, the fiber is drawn as \Lcs{psbezier} curve with the specified nodes. Positioning parameters can be used to
shift the object between \prm{In} and \prm{A} nodes.

\medskip

\begin{LTXexample}
\begin{pspicture}(3,2)
   \fibercollimator[beam](0,1)(2,1)(3,1)(3,2){FC}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Coupler}\label{sec:coupler}
\subsubsection{\texorpdfstring{\mathversion{bold}$2\times 2$}{2x2} Coupler}
\begin{ltxsyntax}
\xLfmultipole{optcoupler}\cmditem{optcoupler}(LeftTop)(LeftBottom)(RightTop)(RightBottom){Label}%
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optcoupler(0,1.5)(0,0.5)(3,1.5)(3,0.5){Coupler}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}
\begin{optionlist}
\numitem[0.2]{couplersize}
\numitem[0.1]{couplersep} The vertical distance between two fiber ports.
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \optcoupler[couplersep=0]%
               (0,1.5)(0,0.5)(3,1.5)(3,0.5){Coupler}
\end{pspicture}
\end{LTXexample}

\choitem[elliptic]{couplertype}{none, elliptic, rectangular, crossswitch}
\begin{LTXexample}
\begin{pspicture}(3,4.5)
  \psset{labeloffset=0.5}
  \optcoupler[couplertype=none]%
                (0,4.5)(0,3.5)(3,4.5)(3,3.5){Coupler}
  \optcoupler[couplertype=rectangular]%
               (0,3)(0,2)(3,3)(3,2){Coupler}
  \optcoupler[couplertype=crossswitch]%
               (0,1.5)(0,0.5)(3,1.5)(3,0.5){Coupler}
\end{pspicture}
\end{LTXexample}

\choitem[center]{align}{top, bottom, center}
\begin{LTXexample}
\begin{pspicture}(3,3)
  \psset{labeloffset=0.4}
  \optcoupler[align=top]%
               (0,3)(0,2)(3,3)(3,2){Top}
  \optcoupler[align=bottom]
               (0,1.5)(0,0.5)(3,1.5)(3,0.5){Bottom}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsubsection{WDM Coupler}
\begin{ltxsyntax}
\xLfmultipole{wdmcoupler}\cmditem{wdmcoupler}(LeftTop)(LeftBottom)(Right){Label}%
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \wdmcoupler(0,1.5)(0,0.5)(3,1){WDM}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}

\begin{optionlist}
\numitem[0.2]{couplersize}
\numitem[0.1]{couplersep} The vertical distance between the two input fiber ports.
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \wdmcoupler[couplersep=0](0,1.5)(0,0.5)(3,1){WDM}
\end{pspicture}
\end{LTXexample}

\choitem[elliptic]{couplertype}{none, elliptic, rectangular}
\begin{LTXexample}
\begin{pspicture}(3,3)
  \psset{labeloffset=0.5}
  \wdmcoupler[couplertype=none](0,3)(0,2)(3,2.5){WDM}
  \wdmcoupler[couplertype=rectangular]%
               (0,1.5)(0,0.5)(3,1){WDM}
\end{pspicture}
\end{LTXexample}

\choitem[center]{align}{top, bottom, center}
\begin{LTXexample}
\begin{pspicture}(3,3)
  \psset{labeloffset=0.4}
  \wdmcoupler[align=top,
                couplertype=none](0,3)(0,2)(3,3){Top}
  \wdmcoupler[align=bottom]
               (0,1.5)(0,0.5)(3,0.5){Bottom}
\end{pspicture}
\end{LTXexample}
\end{optionlist}

\subsubsection{WDM Splitter}
\begin{ltxsyntax}
\xLfmultipole{wdmcoupler}\cmditem{wdmsplitter}(Left)(RightTop)(RightBottom){Label}%
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \wdmsplitter(0,1)(3,1.5)(3,0.5){WDM}
\end{pspicture}
\end{LTXexample}
\end{ltxsyntax}
\begin{optionlist}
\numitem[0.2]{couplersize}
\numitem[0.1]{couplersep} The vertical distance between the two output fiber ports.
\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \wdmsplitter[couplersep=0](0,1)(3,1.5)(3,0.5){WDM}
\end{pspicture}
\end{LTXexample}

\choitem[elliptic]{couplertype}{none, elliptic, rectangular}
\begin{LTXexample}
\begin{pspicture}(3,3)
  \psset{labeloffset=0.5}
  \wdmsplitter[couplertype=none](0,2.5)(3,3)(3,2){WDM}
  \wdmsplitter[couplertype=rectangular]%
                 (0,1)(3,1.5)(3,0.5){Coupler}
\end{pspicture}
\end{LTXexample}

\choitem[center]{align}{top, bottom, center}
\begin{LTXexample}
\begin{pspicture}(3,3)
  \psset{labeloffset=0.4}
  \wdmsplitter[align=top,
                 couplertype=none](0,3)(3,3)(3,2){Top}
  \wdmsplitter[align=bottom](0,0.5)(3,1.5)(3,0.5){Bottom}
\end{pspicture}
\end{LTXexample}
\end{optionlist}


\section{Connecting Objects}\label{sec:connecting}

The package provides several methods for automatic beam and fiber
drawing which are two fundamentally different way of connecting.

\subsection{Accessing Objects}

The macro arguments, specified as Obj$_1$, Obj$_2$, \ldots Obj$_N$ in
the following macro definitions, can be either objects or PSTricks
nodes. To distinguish between named nodes (see \prettyref{sec:namedobj})
and object names, the node content must be enclosed in parenthesis
within the brackets. Components can either be assigned a name
explicitely using the \Lkeyword{compname} parameter, or they get a
unique number in ascending order by their definition in the code. If the
argument is left empty, the last object is used.

\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \pnode(0,1){A}\pnode(1.5,1){B}
  \optbox[endbox, labeloffset=0](A)(B){1}
  % connect an object by its automatic number
  \drawbeam{(A)}{1}
\end{pspicture}
\end{LTXexample}

\medskip

\begin{LTXexample}
\begin{pspicture}(3,2)
  \psset{endbox, labeloffset=0}
  \optbox[compname=obj](0,1)(1.5,1){obj}
  % connect an object by its compname
  \drawbeam{(0,1)}{obj}
\end{pspicture}
\end{LTXexample}

\medskip

The objects which have an explicit \Lkeyword{compname} also increase the internal
counter, so that removing the \nxLkeyword{compname} from an intermediate
object does not affect the numbering of the following ones.

\medskip

\begin{LTXexample}
\begin{pspicture}(3,2)
  \psset{endbox, labeloffset=0}
  \optbox[compname=obj](0,0.5)(1.5,0.5){obj}
  \optbox(0,1.5)(1.5,1.5){2}
  % named objects are also numbered
  \drawbeam{(0,1)}{2}
\end{pspicture}
\end{LTXexample}

\medskip

\begin{LTXexample}
\begin{pspicture}(3,2)
  \psset{endbox, labeloffset=0}
  \optbox(0,0.5)(1.5,0.5){1}
  \optbox(0,1.5)(1.5,1.5){2}
  % an empty argument refers to the last object
  \drawbeam{(0,1)}{}
\end{pspicture}
\end{LTXexample}

\subsection{Drawing beams}\label{sec:drawbeam}

\begin{ltxsyntax}
  \xLcs{drawbeam}\cmditem{drawbeam}[Options]{Obj$_1$}{Obj$_2$}{\ldots}{Obj$_N$}
  \xLcs{drawwidebeam}\cmditem{drawwidebeam}[Options]{Obj$_1$}{Obj$_2$}{\ldots}{Obj$_N$}
\end{ltxsyntax}
The package provides two macros for connecting objects with beams. Most
parameters are valid for both, those which are specified for wide beams
are demonstrated separately in the next section.

\subsubsection{Internal component structure}

In order to understand properly how the automatic beam drawing actually works,
it is necessary to describe in more detail the internal component structure.

Every component type consists internally of interfaces which are defined by a
node on the optical axis, a plane vector or a curvature radius, and by its
optical characteristic (reflective or transmittive). The interface nodes can be
visualized for each component type with the \Lkeyword{showifcnodes}
parameter. 

\medskip

\begin{LTXexample}[width=4cm]
\begin{pspicture}(4,3)
  \psset{showifcnodes}
  \optbox(0,2.5)(4,2.5){}
  \doveprism(0,1.5)(4,1.5){}
  \lens(0,0.5)(4,0.5){}
  \mirror(0,0.5)(3.5,0.5)(3.5,3){}
\end{pspicture}
\end{LTXexample}

\bigskip

\nxLcs{draw*beam} calculates the distance between the interface nodes of two
objects and connects the two nearest

\medskip

\begin{LTXexample}[width=4cm]
\begin{pspicture}(-2,-2)(2,2)
  \psset{optboxwidth=0.6, optboxheight=0.5, labeloffset=0}
  \multido{\i=0+60,\ii=1+1}{6}{%
    \pnode(1.75;\i){A}
    \optbox([Xnodesep=-1]A)([Xnodesep=1]A){\ii}
  }
  \optbox[compname=ref](-1,0)(1,0){ref}
  \addtopsstyle{Beam}{arrows=->}
  \multido{\i=1+1}{6}{\drawbeam{ref}{\i}}
\end{pspicture}
\end{LTXexample}

\begin{optionlist}

\optitem[0]{startpos}{\prm{num} [\prm{num}]}
This is the start position of the beam at the first interface. Can be
any code which evaluates in Postscript to one or two numbers. If is only
one number then the $x$-coordinate is set to \texttt{0}.

\begin{LTXexample}
\begin{pspicture}(5,5)
  \pnode(1.5,0.5){A}\pnode(4.5,0.5){B}\pnode(3.5,4.5){C} 
  \optbox[endbox](B)(A){}
  \mirror[mirrorradius=4](A)(B)(C){} 
  \mirror[mirrortype=extended](B)(C)(B){} 
  \drawbeam[addtoBeam={linecolor=red},
              startpos=-0.2]{1}{2}{3}
  \drawbeam[addtoBeam={linecolor=blue},
              startpos=0]{1}{2}{3}
  \drawbeam[addtoBeam={linecolor=green},
              startpos=0.2]{1}{2}{3}
\end{pspicture}
\end{LTXexample}

\optitem[1]{startvec}{\prm{X} [\prm{Y}]} This is the start vector (\prm{X},
\prm{Y}) of the beam. \prm{X} and \prm{Y} can be anything which evaluates to a
number in Postscript. If only one value is given, \prm{X} is set to \opt{0}. The
\nxLkeyword{startvec} is relative to the connection between the first two
components, use \Lkeyword{startvecabs} to change this. 

\begin{LTXexample}
\begin{pspicture}(5,5)
  \pnode(1.5,0.5){A}\pnode(4.5,0.5){B}\pnode(3.5,4.5){C} 
  \optbox[endbox](B)(A){}
  \mirror[mirrorradius=2](A)(B)(C){} 
  \mirror[mirrortype=extended](B)(C)(B){} 
  \drawbeam[addtoBeam={linecolor=red},
              startvec=0.05]{1}{2}{3}
  \drawbeam[addtoBeam={linecolor=blue},
              startvec=0]{1}{2}{3}
  \drawbeam[addtoBeam={linecolor=green},
              startvec=-0.05]{1}{2}{3}
\end{pspicture}
\end{LTXexample}

\medskip

\boolitem[false]{startvecabs}

\boolitem[false]{connectplanes}

\numitem[1.5]{n}

\boolitem[false]{beaminside}

\boolitem[false]{beaminsidelast}

\boolitem[false]{beaminsidefirst}
\end{optionlist}

\subsection{Drawing wide beams}\label{sec:drawwidebeam}

\begin{optionlist}
\numitem[0.1]{beamwidth}

\numitem[0]{beamdiv}
\end{optionlist}

\subsection{Drawing fibers}\label{sec:drawfiber}

\begin{optionlist}
\boolitem{usefiberstyle}
\end{optionlist}

Fiber-optical objects are automatically connected to the reference
nodes. The style of all fiber connections can be configured
independently (see Sec.~\ref{sec:fiberstyles}).

For some components it might me nice to highlight some
internals. If \Lkeyword{usefiberstyle} is enabled, for examples the
passing parts of the optical filter are drawn with the \styleshape{Fiber}
style. In the documentation this parameter is enabled to show the parts
which would be highlighted.

\begin{ltxsyntax}
  \xLcs{drawfiber}\cmditem{drawfiber}[Options]{Obj$_1$}{Obj$_2$}
\end{ltxsyntax}

\begin{LTXexample}[width=4cm]
\begin{pspicture}[showgrid=true](2.8,3)
\pnode(0.3,0){A}
\pnode(2.3,0){B}
\pnode(0.3,3){C}
\pnode(2.3,3){D}
\optcoupler[abspos=0.5, nofiber](A)(B)(C)(D){}
\optbox[abspos=2, optboxwidth=0.5,optboxheight=0.5](C|A)(C){}
\optfiber[nofiber](D)(C){}
\optamp[nofiber, abspos=2](D|A)(D){}
\drawfiber[angleA=0, ArrowInside=->]{(A)}{1}
\drawfiber[angleB=180, arrows=->]{1}{(B)}
\drawfiber{1}{2}
\drawfiber{2}{3}
\drawfiber{3}{4}
\drawfiber{4}{1}
\end{pspicture}
\end{LTXexample}

\subsubsection{Fiber Styles}\label{sec:fiberstyles}

The appearence of the fiber parts before and after each object can be changed
with several styles (see \ref{sec:styles}). On the left side of the components
are the input connections and on the right side the output connections.

\begin{optionlist}

\styleitem{Fiber}
This is the basic style from which every other fiber style inherits.

\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \addtopsstyle{Fiber}{linecolor=blue}
  \optamp(0,1)(3,1){}
\end{pspicture}
\end{LTXexample}

\styleitem[style=Fiber]{FiberIn}
Controls the fibres on the left side of the component. Inherits from \nxLstyle{Fiber}.

\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \addtopsstyle{FiberIn}{linecolor=blue}
  \optamp(0,1)(3,1){}
\end{pspicture}
\end{LTXexample}

\styleitem[style=FiberIn]{FiberIn1}
\styleitem[style=FiberIn]{FiberIn2}
If the component has two input fibers, \nxLstyle{FiberIn1} sets the style of the
upper one and \nxLstyle{FiberIn2} the style of the lower fiber. Otherwise these
styles are ignored.

\begin{LTXexample}
\begin{pspicture}(3,1.5)
  \addtopsstyle{FiberIn1}{linecolor=blue}
  \addtopsstyle{FiberIn2}{linecolor=green}
  \optcoupler(0,1.5)(0,0)(3,1.5)(3,0){}
\end{pspicture}
\end{LTXexample}

\styleitem[style=Fiber]{FiberOut}
\styleitem[style=FiberOut]{FiberOut1}
\styleitem[style=FiberOut]{FiberOut2}
\end{optionlist}

\medskip

In addition to the psstyles there exist
corresponding \Lkeyword{newFiber\ldots} and \Lkeyword{addtoFiber\ldots}
parameter keys for each of them.

\medskip

\begin{lstlisting}
\psset{addtoFiberIn={arrows=->, arrowscale=1.3}}
\end{lstlisting}

\medskip

\noindent is equivalent to 

\medskip

\begin{lstlisting}
\addtopsstyle{FiberIn}{arrows=->, arrowscale=1.3}
\end{lstlisting}

\medskip

\noindent Accordingly \Lkeyword{newFiberIn} corresponds to \Lcs{newpsstyle\{FiberIn\}\{\ldots\}}.

At first glance these keys make no sense. The reason why I
introduced them was to be able to define special couplers with
\Lcs{newpsobject}. This is only possible if all modifications can be
expressed as parameter keys. Consider for example a WDM splitter which
only couples out a certain spectral range of the input and you want to
mark the output with an arrow:

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}[showgrid=true](3,2)
   \newpsobject{mywdmsplitter}{wdmsplitter}{addtoFiberOut1={arrows=->, arrowscale=1.3, linecolor=blue}, labelangle=180, align=bottom}
   \mywdmsplitter(0,0.5)(3,1.5)(3,0.5){blue band}
\end{pspicture}
\end{LTXexample}

\medskip

Or if you need a coupler with a particular input angle you can do it be extending the appropriate fiber style:

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}[showgrid=true](3,2)
   \newpsobject{mycoupler}{optcoupler}{addtoFiberIn2={angleA=90}, align=top}
   \mycoupler(0.5,1.5)(0.5,0.5)(2.5,1.5)(2.5,0.5){}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Custom beams}\label{sec:custombeam}
\begin{ltxsyntax}
  \xLcs{custombeam}\cmditem{custombeam}[Options]{\nxLcs{draw*beam}}
\end{ltxsyntax}

\begin{optionlist}
\boolitem[false]{startinside}

\boolitem[false]{stopinside}
\end{optionlist}


\section{Defining New Objects}

\subsection{Customized Versions of Existing Macros}

The easiest way to define your own components is to use the
\Lcs{newpsobject} macro. With this you can define a new component using
predefined objects with a set of options. These options serve only as
default values and can be overridden when calling the macro. The
following examples defines a new object \nxLcs{sbn} for the special crystal
used in Sec.~\ref{sec:crystal}.

\medskip

\begin{LTXexample}[width=3.5cm]
\newpsobject{sbn}{crystal}{voltage, lamp, labelangle=45, labeloffset=1.2, fillstyle=solid, fillcolor=yellow!90!black}
\begin{pspicture}[showgrid=true](3,2) 
   \sbn(0,1)(3,1){SBN:Ce}
   \psline[style=Beam](0,1)(3,1)
\end{pspicture}
\end{LTXexample}

\medskip

\begin{LTXexample}[width=3.5cm]
\newpsobject{pumpcoupler}{wdmcoupler}{align=top, labelangle=180, labeloffset=0.5,addtoFiberIn2={ArrowInside=->, arrowscale=2}}
\begin{pspicture}[showgrid=true](3,2) 
   \pumpcoupler(0,1)(0,0)(3,1){Pumpcoupler}
\end{pspicture}
\end{LTXexample}

\medskip

Or if you need more than one type of lenses several times in your setup
it is very cumbersome to specify all parameters every time.

\medskip

\begin{LTXexample}[width=5.5cm]
\newpsobject{MOLensIn}{lens}{lens=0.5 0.5 0.5}
\newpsobject{MOLensOut}{lens}{lens=1.5 1.5 1.5}
\begin{pspicture}[showgrid=true](5,2) 
   \pnode(0,1){A}\pnode(5,1){B}
   \psset{n=1}
   \MOLensIn[abspos=0.5](A)(B){}
   \MOLensOut[abspos=1](A)(B){}
   \MOLensOut[abspos=4](A)(B){}
   \MOLensIn[abspos=4.5](A)(B){}
   \custombeam{%
     \drawwidebeam[beamwidth=0.1]{(A)}{1}
     \drawwidebeam[beamdiv=1]{1}{2}
   }
\end{pspicture}
\end{LTXexample}
\medskip

\subsection{Defining New Objects}\label{sec:newobj}

Since version 1.2 \nxLPack{pst-optexp} provides some high-level macros to
allow very convenient definition of completely new components. The macro
\Lcs{newOptexpDipole} generates all organizing code for a new free-ray
component. All you have to do is to define a new `drawing' macro
\nxLcs{mycomponent@iii} which contains all drawing code. Analogously
\Lcs{newOptexpDipoleNolabel} defines a new free-ray object without label
(like \Lcs{polarization}) and \Lcs{newOptexpTripole} defines a new
reflective component. 

New fiber-optical components can be defined using
\Lcs{newOptexpFiberDipole}. This macro differs from its free-ray
analogous only in that it presets \Lkeyword{fiber} and hence directly
connects the component with its reference nodes. The first node in the
parameter list gets connected with a node \nodename{tempNode@A@}, the
second node with a node \nodename{tempNode@B@}. These two internal
nodes are preset to \paramvalue{(0,0)} and can be overwritten within the
drawing macro.

The syntax of the macros is
\begin{lstlisting}
\newOptexpDipole[fixed options]{name}{default options}
\newOptexpDipoleNolabel[fixed options]{name}{default options}
\newOptexpTripole[fixed options]{name}{default options}
\newOptexpFiberDipole[fixed options]{name}{default options}
\end{lstlisting}
The \texttt{default options} are simply a list of PSTricks parameters
which are taken as defaults for the new component. The optional argument
allows setting of parameters which cannot be overridden later.

This is illustrate a bit more in the next code snippet, which also shows
how the coordinate system is handled within the \nxLcs{mycomponent@iii}
macro.

\medskip

\begin{LTXexample}[width=4.5cm]
\newOptexpTripole{mygrid}{subgriddiv=5, griddots=0, subgridwidth=\pslinewidth, gridwidth=2\pslinewidth}
\makeatletter
\def\mygrid@iii{% put here all PSTricks drawing code
  \psgrid(-1,0)(1,1)
}%
\makeatother
\begin{pspicture}[showgrid=true](4,4) 
   \pnode(0,1){A}\pnode(2,2){G}\pnode(3,0){B}
   \mygrid[gridcolor=red,labeloffset=1.5](A)(G)(B){myGrid}
   \psline[style=Beam](A)(G)(B)
\end{pspicture}
\end{LTXexample}
\medskip

The default position of the label reference point is (0,0). If you want
to change this, you have to define a new pnode named
\nodename{tempNode@Label} in the \nxLcs{mycomponent@iii} macro.

If you create a new component, please send it to me then I can
incorporate this in a new released version.

\newpage

\section{Examples}
\begin{LTXexample}[pos=t,vsep=8mm]
\begin{pspicture}(10,2)
\psset{optboxwidth=1}\addtopsstyle{Beam}{linewidth=2\pslinewidth}
\pnode(1,1){Start}\pnode(9,1){CCD}\optbox[endbox, labeloffset=0](CCD)(Start){Laser}
\optbox[endbox,labeloffset=0,beam](Start)(CCD){CCD}
\polarization[poltype=perp,abspos=0.5](Start)(CCD)
\optretplate[abspos=1](Start)(CCD){$\nicefrac{\lambda}{2}$}
\lens[lens=0.4 0.4 0.5,abspos=2](Start)(CCD){$L_1$}\lens[abspos=4](Start)(CCD){$L_2$}
\optplate[abspos=6,platelinewidth=3\pslinewidth](Start)(CCD){SLM}
\optplate[abspos=6.5,labelangle=180](Start)(CCD){PF}
\polarization[abspos=6.7](Start)(CCD)\lens[abspos=7](Start)(CCD){$L_3$}
\end{pspicture}
\end{LTXexample}

\vspace{\fill}

\begin{LTXexample}[pos=t,vsep=8mm]
\begin{pspicture}(-4,-1)(3,3)
\addtopsstyle{Beam}{linewidth=2\pslinewidth, linecolor=red!90!black}
\psset{labeloffset=0.5}
\pnode(-2,0){LaserOut}\pnode(0,0){Grat}
\pnode(4;45){Out}\pnode(2.5;67.5){Mvar}
\optbox[optboxwidth=2,labeloffset=0, endbox](Grat)(LaserOut){diode laser}
%\mirror[variable,conn=o-](Grid)(Mvar)(Grid){M$_\mathrm{var}$}
\optgrid[beam](LaserOut)(Grat)(Out){grating}
\optretplate[position=0.3,labeloffset=0.8]%
  (LaserOut)(Grat){$\nicefrac{\lambda}{4}$}
\rput[l](-3,2){Littman setup}
\end{pspicture}
\end{LTXexample}

\begin{LTXexample}[pos=t, vsep=8mm]
\begin{pspicture}(8.5,1.6)
    \addtopsstyle{Beam}{linecolor=green!90!black}
    \pnode(1.6,1){Laser}\pnode(7.6,1){Diode}
    \optbox[endbox,labeloffset=0](Diode)(Laser){Laser}%
%    \optbox[abspos=4, optboxwidth=1, optboxheight=0.6, labeloffset=1, compname=PC, conn=o-, angle=-10, rotateref=l, refractiveindex=2.3](Laser)(Diode){Photonic Crystal}
%    \optdetector[dettype=diode, conn=o-](\oenodeout{PC})(Diode|\oenodeout{PC}){PD}
    \optbox[abspos=4, optboxwidth=1, optboxheight=0.6, labeloffset=1, compname=PC, angle=-10, rotateref=l, refractiveindex=2.3](Laser)(Diode){Photonic Crystal}
    \optdetector[dettype=diode](\oenodeout{PC})(Diode|\oenodeout{PC}){PD}
    \defShiftedNode(\oenodein{PC})(2;170){Angle1}
    \psline[linestyle=dashed](\oenodein{PC})(Angle1)
    \psarc{<->}(\oenodein{PC}){1.3}{330}{30}
    \psarc[arcsep=1pt]{<->}(\oenodein{PC}){2}{170}{180}
    \uput{2.1}[175](\oenodein{PC}){\small $\varphi$}
\end{pspicture}
\end{LTXexample}

\begin{LTXexample}[pos=t, vsep=8mm]
\begin{pspicture}(6.4,3.2)
  \addtopsstyle{Fiber}{linecolor=red}
  \pnode(2.3,2.3){Lin}\pnode([Xnodesep=0.5]Lin){Lout}
  \pnode([Xnodesep=1.5]Lout){EAMout}
  \pnode([Xnodesep=1.5]EAMout){Det}
  \optbox[fiber, label=-0.2, endbox, compname=L, extnode=b](Lout)(Lin){%
    \psGauss[yunit=0.03,sigma=0.03]{-0.5}{0.5}}
  \optbox[fiber, label=0, optboxwidth=1, compname=EAM, extnode=b](Lout)(EAMout){EAM}
  \optfiber[labeloffset=0.3](EAMout)(Det){fibre}
  \optdetector(EAMout)(Det){OSA}
  \pnode([Xnodesep=-1,offset=-1]\oenodeext{L}){Osc}
  \pnode(\oenodeext{L}|Osc){PSin}\pnode(\oenodeext{EAM}|Osc){PSout}
  \oscillator[output=right](Osc){10\,GHz}{}
  \phaseshifter[arrowscale=1.5, inputarrow, labeloffset=-0.7](PSin)(PSout){$\tau$}
  \psset{arrows=->, arrowinset=0, arrowscale=1.5}
  \wire(PSin)(\oenodeext{L})
  \wire(PSout)(\oenodeext{EAM})
\end{pspicture}
\end{LTXexample}

\begin{LTXexample}[pos=t, vsep=8mm, preset=\centering]
\begin{pspicture}(0.9,0.9)(10.4,5.9)
  \psset{arrowscale=1.5, arrowinset=0}
  \pnode(2,5){PC1in}\pnode(4,5){PC1out}\pnode(6,5){PC2in}
  \pnode(8,5){PC2out}\pnode(2,2){CplSig}\pnode(5,2){CplIn}
  \pnode(2,1){CplOut}\pnode(10,4.5){Pump}\pnode(8,2){PumpSig}
  \optisolator[compshift=0.8, addtoFiberIn={angleA=180}, 
                 addtoFiberOut={angleB=180}, label=0.5 . l]%
                 (CplSig)(PC1in){isolator}
  \polcontrol[addtoFiberIn={arrows=|-}](PC1in)(PC1out){}
  \optfiberpolarizer[labeloffset=0.6](PC1out)(PC2in){polarizer}
  \polcontrol[addtoFiberOut={arrows=-|}](PC2in)(PC2out){}
  \wdmsplitter[labeloffset=0.3, align=bottom, addtoFiberIn={arrows=|-}, 
                 addtoFiberOut1={arrows=->}, addtoFiberOut2={arrows=-|}]%
                 (CplIn)(CplOut)(CplSig){95/5}
  \wdmcoupler[addtoFiberIn1={ArrowInside=->}, addtoFiberIn2={angleA=0}, 
                addtoFiberOut={angleB=0,arrows=-|}, ncurv=0.9, 
                align=bottom, compshift=0.8](Pump)(PC2out)(PumpSig){Pump}
  \optbox[endbox, label=0 . . relative]([offset=-0.1]Pump)(Pump){980~nm}
  \optfiber[fiberloops=2, labeloffset=0.4](CplIn)(PumpSig){Er$^+$-doped}
\end{pspicture}
\end{LTXexample}

\begin{LTXexample}[pos=t, vsep=8mm]
\makeatletter
\def\LCLV@nodes{%
  \newOptexpComp{ {-0.12 0} {0 1} trans {NewPlaneInt}
                  {0.15 0} {0 1} trans {NewPlaneInt} \psk@oe@n}%
}%
\def\LCLV@comp{%
  \psframe[fillstyle=solid,fillcolor=black,dimen=outer](-0.12,-0.5)(0,0.5)
  \psframe[fillstyle=solid,fillcolor=gray!50,dimen=outer](0,-0.5)(0.15,0.5)
}%
\makeatother
\begin{pspicture}(9,5)
\newOptexpDipole{LCLV}{}\psset{lens=1.2 0 1}
\pnode(2.4,1){BS1}\pnode([offset=3]BS1){M1}\pnode([Xnodesep=5.5]M1){PP}\pnode(PP|BS1){BS2}
\LCLV[position=0.2, compname=LCLV](BS1)(BS2){LCLV}\beamsplitter[compname=BS](BS2)(BS1)(M1){BS}
\optretplate(BS1)(M1){P}\mirror(BS1)(M1)(PP){M}\lens[position=0.2](M1)(PP){L}
\pinhole(M1)(PP){}\lens[position=0.2](PP)(M1){L}\pentaprism(M1)(PP)(BS2){PP}
\beamsplitter(PP)(BS2)(BS1){BS}\lens(BS2)(BS1){L}
\doveprism[compname=Dove,position=0.27](BS2)(BS1){D}
\addtopsstyle{Beam}{arrowscale=1.3, ArrowInside=-<}
\optbox[labeloffset=0, endbox](BS1)([Xnodesep=-1]BS1){Nd:YAG}
\drawbeam{LCLV}{BS}
\end{pspicture}
\end{LTXexample}

%\begin{LTXexample}[pos=t,vsep=8mm]
\begin{pspicture}(0,-0.4)(9,6)
  \addtopsstyle{Beam}{linewidth=2\pslinewidth}
  \pnode(1.5,5){Laser}\pnode(4,5){PBS}\pnode(6.5,5){PBS2}
  \pnode(6.5,5.7){piezo}\pnode(4,2){BSFwd}\pnode(6.5,2){BSBwd}
  \pnode(2,2){BS4f}\pnode(2,0.5){M4f3}\pnode(8,2){M4f1}
  \pnode(8,0.5){M4f2}\pnode(1,2){CCD}
  \psline[style=Beam](Laser)(PBS2)(piezo)(BSBwd)(M4f1)(M4f2)(M4f3)(BS4f)(CCD)
  \psline[style=Beam](PBS)(BSFwd)(BS4f)
  \psset{mirrorwidth=0.6, plateheight=0.7, outerheight=0.7, labeloffset=0.7, labelstyle=\scriptsize, lens=1.2 1.2 0.8, bssize=0.5} 
  \optbox[endbox,optboxwidth=1.5, optboxheight=0.7,labeloffset=0]%
     (PBS)(Laser){\parbox{1.5cm}{\centering Nd:YAG\\ 532\,nm}}
  \lens[lensheight=0.5, position=0.2](Laser)(PBS){MO}
  \pinhole[position=0.3,labelangle=180](Laser)(PBS){PH}
  \lens[position=0.5](Laser)(PBS){L}
  \optretplate[position=0.8](Laser)(PBS){$\nicefrac{\lambda}{2}$}
  \beamsplitter(Laser)(PBS)(BSFwd){PBS}
  \optretplate[position=0.4](PBS)(BSFwd){$\nicefrac{\lambda}{2}$}
  \polarization(PBS)(BSFwd)\polarization(PBS2)(BSBwd)
  \lens[position=0.8](PBS)(BSFwd){L}
  \optretplate(PBS)(PBS2){$\nicefrac{\lambda}{2}$}
  \beamsplitter(PBS)(PBS2)(piezo){PBS}
  \optretplate[abspos=0.5](PBS2)(piezo){$\nicefrac{\lambda}{4}$}
  \mirror[mirrortype=piezo,labelangle=90](PBS2)(piezo)(PBS2){PZ}
  \lens[position=0.8,labelangle=180](PBS2)(BSBwd){L}
  \crystal[crystalwidth=1, crystalheight=0.5, voltage, lamp, fillstyle=solid, fillcolor=yellow!90!black, labeloffset=0.8, beam](BSFwd)(BSBwd){SBN:Ce}
  \beamsplitter(PBS)(BSFwd)(BSBwd){BS}
  \beamsplitter[labelangle=-90](PBS2)(BSBwd)(BSFwd){BS}
  \mirror(BSBwd)(M4f1)(M4f2){M}\mirror(M4f1)(M4f2)(M4f3){M}
  \lens[labelangle=180](M4f2)(M4f3){L}\mirror(M4f2)(M4f3)(BS4f){M}
  \beamsplitter(M4f3)(BS4f)(CCD){BS}\optbox[endbox,labeloffset=0, optboxwidth=1](BS4f)(CCD){CCD}
  \lens[abspos=0.7](BS4f)(BSFwd){L}\lens[abspos=0.7](BSBwd)(M4f1){L}
\end{pspicture}
%\end{LTXexample}

\psset{unit=0.8cm,labelstyle=\footnotesize}
%\begin{LTXexample}[pos=t]
\begin{pspicture}(0.5,4)(13.2,10.5)
  \addtopsstyle{Fiber}{linecolor=red!90!black}\psset{usefiberstyle, optboxwidth=1}
  \pnode(2,10){LD}\pnode([Xnodesep=5.5]LD){CPLin1}
  \pnode([offset=-2]CPLin1){CPLin2}\pnode([Xnodesep=1.5]CPLin1){CPLout1}
  \pnode([Xnodesep=1.5]CPLin2){CPLout2}
  \optbox[endbox, labeloffset=0, fiber]([Xnodesep=0.1]LD)(LD){LD}
  \optmzm([Xnodesep=0.1]LD)([Xnodesep=1.5]LD){MZM}
  \optamp([Xnodesep=1.5]LD)([Xnodesep=2.5]LD){EDFA}
  \optfilter([Xnodesep=2.5]LD)([Xnodesep=3.5]LD){BPF}
  \optswitch([Xnodesep=3.5]LD)([Xnodesep=4.5]LD){SW}
  \polcontrol([Xnodesep=4.5]LD)(CPLin1){}
  \optcoupler[couplertype=none](CPLin1)(CPLin2)(CPLout1)(CPLout2){}
  \optamp(CPLout1)([Xnodesep=1.5]CPLout1){EDFA}
  \optfilter([Xnodesep=1.5]CPLout1)([Xnodesep=3]CPLout1){BPF}
%  \optbox[endbox, labeloffset=0, conn=f-f]([Xnodesep=3]CPLout1)([Xnodesep=3.1]CPLout1){RX}
  \pnode([Xnodesep=2]CPLout2){LoopRU}\pnode([offset=-3.5]LoopRU){LoopRL}
  \pnode([Xnodesep=-5]CPLin2){LoopLU}\pnode([offset=-3.5]LoopLU){LoopLL}
  \optamp(CPLout2)(LoopRU){EDFA}
  \psline[linearc=1,style=Fiber](LoopRU)([Xnodesep=1]LoopRU)([Xnodesep=1,offset=-2]LoopRU)
  \psline[linearc=1,style=Fiber]([Xnodesep=1,offset=1.5]LoopRL)%
                                ([Xnodesep=1]LoopRL)(LoopRL)
  \optfiber[labelalign=b, labeloffset=-1, position=0.8]([Xnodesep=-2]LoopRL)(LoopRL){\begin{tabular}{c}conventional\\fibre 89.8~km\end{tabular}}
  \optamp([Xnodesep=-2]LoopRL)([Xnodesep=-3]LoopRL){EDFA}
  \optfilter([Xnodesep=-3]LoopRL)([Xnodesep=-4.5]LoopRL){BPF}
  \optfiber[fiberloops=1, labeloffset=-1, labelalign=b]([Xnodesep=-7]LoopRL)([Xnodesep=-4.5]LoopRL){DCF 16.2~km}
  \optamp([Xnodesep=1.5]LoopLL)(LoopLL){EDFA}
  \psline[style=Fiber,linearc=1](LoopLL)([Xnodesep=-1]LoopLL)%
                                ([Xnodesep=-1,offset=3.5]LoopLL)(LoopLU)
  \optfilter(LoopLU)([Xnodesep=1.5]LoopLU){BPF}
  \optswitch([Xnodesep=1.5]LoopLU)([Xnodesep=3.5]LoopLU){SW}
  \polcontrol([Xnodesep=3.5]LoopLU)(CPLin2){}
\end{pspicture}
%\end{LTXexample}

\section{Requirements}

\LPack{pst-optexp} version 3.0 requires at least version 2.87 of
\LPack{pstricks-add}, \LPack{multido}, \LPack{pst-eucl}, \LPack{environ} and
\LaTeX. It does not work with plain \TeX.

\section{Todo}

\begin{itemize}
\item Automatic sizing of optboxes (like a \Lcs{psframebox}
\end{itemize}

\section{Acknowledgements}

I thank all the people of the PSTricks mailinglist for the continuous help, especially Herbert Voß.


\printindex
\end{document}
